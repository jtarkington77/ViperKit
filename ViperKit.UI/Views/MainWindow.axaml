<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:ViperKit.UI.Models"
        x:Class="ViperKit.UI.Views.MainWindow"
        Width="1200"
        Height="750"
        Title="ViperKit"
        Background="#05090A">


  <Grid RowDefinitions="110,*">

    <!-- HEADER BAR -->
    <Border Grid.Row="0"
            Background="#070D0F"
            Padding="16,10"
            BorderBrush="#10191C"
            BorderThickness="0,0,0,2">
      <Grid ColumnDefinitions="Auto,*">

        <!-- LOGO -->
        <Image Grid.Column="0"
               Width="96"
               Height="96"
               Margin="0,0,16,0"
               Stretch="Uniform"
               Source="avares://ViperKit.UI/Assets/logo.png" />

        <!-- TITLE TEXT -->
        <StackPanel Grid.Column="1"
                    VerticalAlignment="Center"
                    Orientation="Vertical">
          <TextBlock Text="ViperKit"
                     FontSize="32"
                     FontWeight="Bold"
                     Foreground="#00FFF8" />
          <TextBlock Text="Incident Response Toolkit"
                     FontSize="14"
                     Foreground="#8FA9AA" />
        </StackPanel>

      </Grid>
    </Border>

    <!-- MAIN BODY -->
    <Border Grid.Row="1"
            Background="#05090A"
            Padding="12,8,12,12">

      <!-- SIMPLE TABS – Avalonia defaults -->
      <TabControl TabStripPlacement="Top">

                <!-- DASHBOARD -->
                <TabItem Header="Dashboard">
                  <Border Background="#0B1518" Padding="16">
                    <StackPanel Orientation="Vertical" Spacing="16">

                      <!-- TITLE -->
                      <TextBlock Text="Dashboard"
                                FontSize="20"
                                FontWeight="SemiBold"
                                Foreground="#EAF7F7" />

                      <TextBlock Text="High-level view of this host and the current incident case."
                                FontSize="13"
                                Foreground="#8FA9AA"
                                TextWrapping="Wrap" />

                      <!-- TWO-COLUMN LAYOUT: SYSTEM SNAPSHOT + CASE SUMMARY -->
                      <Grid ColumnDefinitions="*,*" ColumnSpacing="16">

                        <!-- SYSTEM SNAPSHOT CARD -->
                        <Border Grid.Column="0"
                                Background="#050E10"
                                Padding="12"
                                CornerRadius="6"
                                BorderBrush="#1A3C3F"
                                BorderThickness="1">
                          <StackPanel Spacing="6">
                            <TextBlock Text="System Snapshot"
                                      FontSize="14"
                                      FontWeight="SemiBold"
                                      Foreground="#EAF7F7" />
                            <TextBlock x:Name="SystemHostNameText"
                                      Text="Host: (loading...)"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />
                            <TextBlock x:Name="SystemUserText"
                                      Text="User: (loading...)"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />
                            <TextBlock x:Name="SystemOsText"
                                      Text="OS: (loading...)"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />
                          </StackPanel>
                        </Border>

                        <!-- CASE SUMMARY CARD -->
                        <Border Grid.Column="1"
                                Background="#050E10"
                                Padding="12"
                                CornerRadius="6"
                                BorderBrush="#1A3C3F"
                                BorderThickness="1">
                          <StackPanel Spacing="8">
                            <TextBlock Text="Current Case"
                                      FontSize="14"
                                      FontWeight="SemiBold"
                                      Foreground="#EAF7F7" />

                            <TextBlock x:Name="CaseIdText"
                                      Text="Case ID: (none)"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />

                            <TextBlock x:Name="CaseEventsCountText"
                                      Text="Events: 0"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />

                            <TextBlock x:Name="CaseLastEventText"
                                      Text="Last: (no events yet)"
                                      FontSize="12"
                                      Foreground="#8FA9AA"
                                      TextWrapping="Wrap" />

                            <StackPanel Orientation="Horizontal"
                                        Spacing="8"
                                        Margin="0,8,0,0">
                              <Button x:Name="CaseExportButton"
                                      Content="Export Case Report"
                                      Width="160"
                                      Click="CaseExportButton_OnClick" />
                            </StackPanel>
                          </StackPanel>
                        </Border>

                      </Grid>

                      <!-- DASHBOARD STATUS / MESSAGES -->
                      <TextBlock x:Name="DashboardStatusText"
                                Text="Status: case initialising..."
                                FontSize="12"
                                Foreground="#8FA9AA"
                                TextWrapping="Wrap" />
                    </StackPanel>
                  </Border>
                </TabItem>

                <!-- HUNT -->
                <TabItem Header="Hunt">
                  <Border Background="#0B1518" Padding="16">
                    <StackPanel Orientation="Vertical" Spacing="8">

                            <TextBlock Text="Step 1 – Hunt the thing you stopped"
                                        FontSize="16"
                                        FontWeight="SemiBold"
                                        Foreground="#EAF7F7"
                                        Margin="0,0,0,4" />

                              <TextBlock Text="Start from the process, tool, or file you killed or removed. We’ll carry that forward into Persist and Sweep as the case focus."
                                        FontSize="12"
                                        Foreground="#8FA9AA"
                                        TextWrapping="Wrap"
                                        Margin="0,0,0,8" />
                      <!-- 5-row grid: IOC, status, scope, buttons, text results -->
                      <Grid RowDefinitions="Auto,Auto,Auto,Auto,*" RowSpacing="8">

                              <!-- IOC input + type + run -->
                              <StackPanel Grid.Row="0"
                                          Orientation="Horizontal"
                                          Spacing="8">
                                <TextBox x:Name="HuntIocInput"
                                        Width="420"
                                        Watermark="Paste path, hash, domain, IP, registry key..." />

                                <ComboBox x:Name="HuntIocType"
                                          Width="170">
                                  <ComboBoxItem Content="Auto"      />
                                  <ComboBoxItem Content="File path" />
                                  <ComboBoxItem Content="Hash"      />
                                  <ComboBoxItem Content="Domain/URL"/>
                                  <ComboBoxItem Content="IP address"/>
                                  <ComboBoxItem Content="Registry"  />
                                </ComboBox>

                                <Button x:Name="HuntRunButton"
                                        Content="Run Hunt"
                                        Width="110"
                                        Click="HuntRunButton_OnClick" />

                                <!-- NEW: push this IOC into case focus -->
                                <Button x:Name="HuntSetCaseFocusButton"
                                        Content="Set as case focus"
                                        Width="150"
                                        Click="HuntSetCaseFocusButton_OnClick" />
                              </StackPanel>
                              
                        <!-- Status line -->
                        <TextBlock x:Name="HuntStatusText"
                                   Grid.Row="1"
                                   Text="Status: idle."
                                   Foreground="#C7D4D4" />

                        <!-- Scope folder row -->
                        <StackPanel Grid.Row="2"
                                    Orientation="Horizontal"
                                    Spacing="8">
                          <TextBlock Text="Scope folder:"
                                     VerticalAlignment="Center"
                                     Foreground="#C7D4D4" />
                          <TextBox x:Name="HuntScopeFolderInput"
                                   Width="420"
                                   Watermark="Optional: folder to scan for matching files" />
                          <Button x:Name="HuntBrowseScopeButton"
                                  Content="Browse..."
                                  Width="100"
                                  Click="HuntBrowseScopeButton_OnClick" />
                        </StackPanel>

                        <!-- Action buttons under status -->
                        <StackPanel Grid.Row="3"
                                    Orientation="Horizontal"
                                    Spacing="8">
                          <Button x:Name="HuntCopyResultsButton"
                                  Content="Copy Results"
                                  Width="120"
                                  Click="HuntCopyResultsButton_OnClick" />

                          <Button x:Name="HuntSaveResultsButton"
                                  Content="Save Snapshot"
                                  Width="130"
                                  Click="HuntSaveResultsButton_OnClick" />

                          <Button x:Name="HuntClearButton"
                                  Content="Clear"
                                  Width="80"
                                  Click="HuntClearButton_OnClick" />
                        </StackPanel>         

                        <!-- Text results area -->
                        <TextBox x:Name="HuntResultsText"
                                 Grid.Row="4"
                                 AcceptsReturn="True"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 FontFamily="Consolas"
                                 Background="#05090A"
                                 Foreground="#E4F3F3" />
                      </Grid>

                      <!-- Structured results list -->
                      <Border Margin="0,8,0,0"
                              Background="#050E10"
                              Padding="8">
                        <StackPanel Spacing="8">

                          <TextBlock Text="Matches"
                                     FontSize="14"
                                     FontWeight="SemiBold"
                                     Foreground="#EAF7F7" />

                          <ListBox x:Name="HuntResultsList"
                                   BorderThickness="0">
                            <ListBox.ItemTemplate>
                              <DataTemplate x:DataType="models:HuntResult">
                                <Border Margin="0,4,0,4"
                                        Padding="6"
                                        Background="#07161A"
                                        CornerRadius="4">
                                  <StackPanel Spacing="2">
                                    <TextBlock>
                                      <Run Text="[" />
                                      <Run Text="{Binding Category}" />
                                      <Run Text="] " />
                                      <Run Text="{Binding Severity}" />
                                      <Run Text=" – " />
                                      <Run Text="{Binding Summary}" />
                                    </TextBlock>
                                    <TextBlock Text="{Binding Target}"
                                               FontSize="11"
                                               Foreground="#9FB9BA"
                                               TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding Details}"
                                               FontSize="11"
                                               Foreground="#7FA3A4"
                                               TextWrapping="Wrap" />
                                  </StackPanel>
                                </Border>
                              </DataTemplate>
                            </ListBox.ItemTemplate>
                          </ListBox>

                          <StackPanel Orientation="Horizontal" Spacing="8">
                            <Button Content="Open location"
                                    Width="120"
                                    Click="HuntOpenLocationButton_OnClick" />
                            <Button Content="Copy target"
                                    Width="120"
                                    Click="HuntCopyTargetButton_OnClick" />
                          </StackPanel>

                        </StackPanel>
                      </Border>

                    </StackPanel>
                  </Border>
                </TabItem>

                <!-- PERSIST -->
                <TabItem Header="Persist">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Header / Run -->
                    <StackPanel Grid.Row="0"
                                Orientation="Horizontal"
                                Spacing="8"
                                VerticalAlignment="Center">
                        <TextBlock Text="Persistence map"
                                  FontSize="16"
                                  FontWeight="Bold"
                                  Margin="0,0,8,0" />

                        <Button x:Name="PersistRunButton"
                                Content="Run persistence scan"
                                Click="PersistRunButton_OnClick"
                                MinWidth="180"
                                Margin="0,0,8,0" />

                        <TextBlock x:Name="PersistStatusText"
                                  Text="Status: idle."
                                  VerticalAlignment="Center"
                                  TextWrapping="Wrap" />
                    </StackPanel>

                    <!-- Summary / Triage Panel -->
                    <Border Grid.Row="1"
                            Background="#0A1214"
                            CornerRadius="6"
                            Padding="12"
                            Margin="0,12,0,0"
                            BorderBrush="#1A3C3F"
                            BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="24">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#5A1E2C" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistHighSignalCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#FF9999" />
                                </Border>
                                <TextBlock Text="High-signal"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#5A1E2C" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistCheckCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#FF9999" />
                                </Border>
                                <TextBlock Text="CHECK"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#4A3D16" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistNoteCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#FFCC66" />
                                </Border>
                                <TextBlock Text="NOTE"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#1E3D2A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistOkCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#99CC99" />
                                </Border>
                                <TextBlock Text="OK"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#2A3A5A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistFocusMatchCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#99CCFF" />
                                </Border>
                                <TextBlock Text="Match focus"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                   <!-- Filters row -->
                  <StackPanel Grid.Row="2"
                              Orientation="Horizontal"
                              Spacing="12"
                              Margin="0,12,0,8">

                    <!-- Show only CHECK entries -->
                    <CheckBox x:Name="PersistShowCheckOnlyCheckBox"
                              Content="Show only 'CHECK' entries"
                              VerticalAlignment="Center"
                              Checked="PersistFilterCheckBox_OnChanged"
                              Unchecked="PersistFilterCheckBox_OnChanged" />

                    <!-- Filter by case focus -->
                    <CheckBox x:Name="PersistFilterByFocusCheckBox"
                              Content="Filter by case focus"
                              Margin="12,0,0,0"
                              VerticalAlignment="Center"
                              Foreground="#8FA9AA"
                              IsChecked="False"
                              Checked="PersistFilterCheckBox_OnChanged"
                              Unchecked="PersistFilterCheckBox_OnChanged" />

                    <!-- NEW: risk / triage mode -->
                    <ComboBox x:Name="PersistRiskFilterCombo"
                              Width="170"
                              SelectedIndex="0"
                              SelectionChanged="PersistRiskFilterCombo_OnSelectionChanged">
                      <ComboBoxItem>All severities</ComboBoxItem>
                      <ComboBoxItem>High-signal hotspots</ComboBoxItem>
                      <ComboBoxItem>CHECK only</ComboBoxItem>
                      <ComboBoxItem>Notes &amp; OK</ComboBoxItem>
                    </ComboBox>

                    <ComboBox x:Name="PersistLocationFilterCombo"
                              Width="180"
                              SelectionChanged="PersistLocationFilterCombo_OnSelectionChanged">
                      <ComboBoxItem>All locations</ComboBoxItem>
                      <ComboBoxItem>Registry autoruns</ComboBoxItem>
                      <ComboBoxItem>Startup folders</ComboBoxItem>
                      <ComboBoxItem>Services / drivers</ComboBoxItem>
                      <ComboBoxItem>Scheduled tasks</ComboBoxItem>
                    </ComboBox>

                    <TextBox x:Name="PersistSearchTextBox"
                            Width="260"
                            Watermark="Search name, path, source, reason..."
                            TextChanged="PersistSearchTextBox_OnTextChanged" />
                  </StackPanel>

                   <!-- Results + detail -->
                  <Grid Grid.Row="3"
                        ColumnDefinitions="2*,*">
                    <!-- List -->
                    <ListBox x:Name="PersistResultsList"
                            Grid.Column="0"
                            Margin="0,0,8,0"
                            DoubleTapped="PersistResultsList_OnDoubleTapped">
                      <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="models:PersistItem">
                          <Border Padding="8"
                                  Margin="0,0,0,6"
                                  CornerRadius="4"
                                  BorderThickness="{Binding FocusBorderThickness}"
                                  BorderBrush="{Binding FocusBorderBrush}">
                            <StackPanel Spacing="2">
                              <!-- Top line: Risk badge + location/source -->
                              <StackPanel Orientation="Horizontal"
                                          Spacing="8">
                                <Border Padding="6,2"
                                        CornerRadius="3"
                                        Background="{Binding RiskBackground}">
                                  <TextBlock Text="{Binding Risk}"
                                            FontSize="11"
                                            FontWeight="SemiBold" />
                                </Border>

                                <TextBlock FontSize="11">
                                  <Run Text="{Binding LocationType}" />
                                  <Run Text=" • " />
                                  <Run Text="{Binding Source}" />
                                </TextBlock>
                              </StackPanel>

                              <!-- Name -->
                              <TextBlock Text="{Binding Name}"
                                        FontWeight="SemiBold"
                                        Margin="0,4,0,0" />

                              <!-- Path / RegistryPath (truncated) -->
                              <TextBlock Text="{Binding Path}"
                                        FontSize="11"
                                        TextTrimming="CharacterEllipsis" />
                              <TextBlock Text="{Binding RegistryPath}"
                                        FontSize="11"
                                        TextTrimming="CharacterEllipsis" />

                              <!-- Reason -->
                              <TextBlock Text="{Binding Reason}"
                                        FontSize="11"
                                        Margin="0,4,0,0"
                                        TextWrapping="Wrap" />

                              <!-- MITRE -->
                              <TextBlock Text="{Binding MitreTechnique}"
                                        FontSize="10"
                                        Foreground="#FFAAAAAA" />
                            </StackPanel>
                          </Border>
                        </DataTemplate>
                      </ListBox.ItemTemplate>

                    </ListBox>

                        <!-- Detail pane (bound to selected item) -->
                        <Border Grid.Column="1"
                                Padding="8"
                                CornerRadius="4"
                                BorderThickness="1"
                                BorderBrush="#333">
                            <StackPanel DataContext="{Binding SelectedItem, ElementName=PersistResultsList}"
                                        x:DataType="models:PersistItem"
                                        Spacing="4">
                                <TextBlock Text="Selected entry"
                                          FontWeight="Bold"
                                          Margin="0,0,0,4" />

                                <TextBlock Text="{Binding Name}"
                                          FontSize="14"
                                          FontWeight="SemiBold" />

                                <TextBlock Text="{Binding Risk}"
                                          FontSize="12" />

                                <TextBlock Text="{Binding LocationType}" />
                                <TextBlock Text="{Binding Source}" />

                                <TextBlock Text="Path:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding Path}"
                                          FontSize="11"
                                          TextWrapping="Wrap" />

                                <TextBlock Text="Registry path:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding RegistryPath}"
                                          FontSize="11"
                                          TextWrapping="Wrap" />

                                <TextBlock Text="Reason:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding Reason}"
                                          FontSize="11"
                                          TextWrapping="Wrap" />

                                <TextBlock Text="MITRE technique:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding MitreTechnique}"
                                          FontSize="11" />

                                <TextBlock Text="Publisher:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding Publisher}"
                                          FontSize="11"
                                          TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                    </Grid>

                    <!-- Footer -->
                    <StackPanel Grid.Row="4"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,8,0,0"
                                Spacing="8">
                        <Button x:Name="PersistCopyResultsButton"
                                Content="Copy results"
                                MinWidth="120"
                                Click="PersistCopyResultsButton_OnClick" />
                        <Button x:Name="PersistSaveResultsButton"
                                Content="Save snapshot"
                                MinWidth="120"
                                Click="PersistSaveResultsButton_OnClick" />
                        <Button x:Name="PersistAddToCaseButton"
                                Content="Add selected to case"
                                MinWidth="170"
                                Click="PersistAddToCaseButton_OnClick" />

                        <!-- NEW: set case focus from Persist -->
                        <Button x:Name="PersistSetFocusButton"
                                Content="Set as case focus"
                                MinWidth="150"
                                Click="PersistSetFocusButton_OnClick" />

                        <Button x:Name="PersistOpenSelectedButton"
                                Content="Investigate selected"
                                Click="PersistOpenSelectedButton_OnClick"
                                MinWidth="150" />
                    </StackPanel>

                </Grid>
            </TabItem>


                <!-- SWEEP -->
                <TabItem Header="Sweep">
                  <Grid Margin="16"
                        RowDefinitions="Auto,Auto,Auto,*,Auto"
                        RowSpacing="8">

                    <!-- Title -->
                    <TextBlock Grid.Row="0"
                              Text="Sweep – recent change radar"
                              FontSize="20"
                              FontWeight="SemiBold"
                              Margin="0,0,0,8"/>

                    <!-- Summary / Triage Panel -->
                    <Border Grid.Row="1"
                            Background="#0A1214"
                            CornerRadius="6"
                            Padding="12"
                            BorderBrush="#1A3C3F"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <!-- Counts row -->
                            <StackPanel Orientation="Horizontal" Spacing="24">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#5A1E2C" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepHighCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#FF9999" />
                                    </Border>
                                    <TextBlock Text="HIGH"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#4A3D16" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepMediumCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#FFCC66" />
                                    </Border>
                                    <TextBlock Text="MEDIUM"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#1E3D2A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepLowCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#99CC99" />
                                    </Border>
                                    <TextBlock Text="LOW"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>

                                <Separator Width="1" Background="#333" />

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#5A2A5A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepFocusMatchCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#FF99FF" />
                                    </Border>
                                    <TextBlock Text="Focus match"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#4A3A1A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepTimeClusterCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#FFB347" />
                                    </Border>
                                    <TextBlock Text="Time cluster"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>
                            </StackPanel>

                            <!-- Focus targets with timestamps -->
                            <TextBlock x:Name="SweepFocusTargetsText"
                                      Text="Focus targets: (none set)"
                                      FontSize="11"
                                      Foreground="#8FA9AA"
                                      TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>

                    <!-- Controls row -->
                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                Spacing="12"
                                VerticalAlignment="Center">

                      <TextBlock Text="Look back:"
                                VerticalAlignment="Center"/>

                      <ComboBox x:Name="SweepLookbackCombo"
                                Width="140"
                                SelectedIndex="0">
                        <ComboBoxItem Content="24 hours" />
                        <ComboBoxItem Content="3 days" />
                        <ComboBoxItem Content="7 days" />
                        <ComboBoxItem Content="30 days" />
                      </ComboBox>

                      <Button x:Name="SweepRunButton"
                              Content="Run Sweep"
                              Click="SweepRunButton_OnClick" />

                      <Separator Width="16" />

                      <TextBlock Text="Severity:"
                                VerticalAlignment="Center"/>

                      <ComboBox x:Name="SweepSeverityFilterCombo"
                                Width="120"
                                SelectedIndex="0"
                                SelectionChanged="SweepSeverityFilterCombo_OnSelectionChanged">
                        <ComboBoxItem Content="All" />
                        <ComboBoxItem Content="High only" />
                        <ComboBoxItem Content="Medium only" />
                        <ComboBoxItem Content="Low only" />
                      </ComboBox>

                      <CheckBox x:Name="SweepShowOnlyFlaggedCheckBox"
                                Content="MED/HIGH only"
                                Margin="8,0,0,0"
                                IsChecked="True"
                                Checked="SweepFilterCheckBox_OnChanged"
                                Unchecked="SweepFilterCheckBox_OnChanged"/>

                      <Separator Width="16" />

                      <CheckBox x:Name="SweepShowClusterHitsOnlyCheckBox"
                                Content="Cluster hits only"
                                Margin="0"
                                IsChecked="False"
                                Checked="SweepFilterCheckBox_OnChanged"
                                Unchecked="SweepFilterCheckBox_OnChanged"/>

                      <TextBlock Text="Window:"
                                VerticalAlignment="Center"
                                Margin="8,0,0,0"/>

                      <ComboBox x:Name="SweepClusterWindowCombo"
                                Width="100"
                                SelectedIndex="1"
                                SelectionChanged="SweepClusterWindowCombo_OnSelectionChanged">
                        <ComboBoxItem Content="± 1 hour" />
                        <ComboBoxItem Content="± 2 hours" />
                        <ComboBoxItem Content="± 4 hours" />
                        <ComboBoxItem Content="± 8 hours" />
                      </ComboBox>

                      <TextBlock x:Name="SweepStatusText"
                                Margin="24,0,0,0"
                                VerticalAlignment="Center"
                                Text="Status: idle."/>
                    </StackPanel>

                            <!-- Search + results -->
                            <Grid Grid.Row="3"
                                  RowDefinitions="Auto,*"
                                  RowSpacing="8">

                              <!-- Search box -->
                              <TextBox Grid.Row="0"
                                      x:Name="SweepSearchTextBox"
                                      Watermark="Search name / path / reason"
                                      TextChanged="SweepSearchTextBox_OnTextChanged"/>

                              <!-- Scrollable results -->
                              <ListBox Grid.Row="1"
                                      x:Name="SweepResultsList"
                                      VerticalAlignment="Stretch">
                                <ListBox.ItemTemplate>
                                  <DataTemplate x:DataType="models:SweepEntry">
                                    <Border Margin="0,4"
                                            Padding="8"
                                            CornerRadius="4"
                                            Background="#121b1f"
                                            BorderThickness="{Binding ClusterBorderThickness}"
                                            BorderBrush="{Binding ClusterBorderBrush}">
                                      <StackPanel Spacing="4">
                                          <!-- Top line: Severity badge + cluster indicator + category -->
                                          <StackPanel Orientation="Horizontal" Spacing="8">
                                            <Border Padding="6,2"
                                                    CornerRadius="3"
                                                    Background="{Binding SeverityBackground}">
                                              <TextBlock Text="{Binding Severity}"
                                                        FontSize="11"
                                                        FontWeight="SemiBold"
                                                        Foreground="{Binding SeverityForeground}" />
                                            </Border>

                                            <Border Padding="6,2"
                                                    CornerRadius="3"
                                                    Background="#3A2A4A"
                                                    IsVisible="{Binding HasClusterIndicator}">
                                              <TextBlock Text="{Binding ClusterIndicator}"
                                                        FontSize="10"
                                                        FontWeight="Bold"
                                                        Foreground="#FF99FF" />
                                            </Border>

                                            <TextBlock FontSize="11" VerticalAlignment="Center">
                                              <Run Text="["/>
                                              <Run Text="{Binding Category}" />
                                              <Run Text="] " />
                                              <Run Text="{Binding Name}" FontWeight="SemiBold" />
                                            </TextBlock>
                                          </StackPanel>

                                          <!-- Path -->
                                          <TextBlock Text="{Binding Path}"
                                                    FontSize="11"
                                                    Foreground="#c0c0c0"
                                                    TextTrimming="CharacterEllipsis" />

                                          <!-- Modified + Source -->
                                          <TextBlock FontSize="11"
                                                    Foreground="#a0a0a0">
                                            <Run Text="Modified: " />
                                            <Run Text="{Binding Modified}" />
                                            <Run Text="  •  Source: " />
                                            <Run Text="{Binding Source}" />
                                          </TextBlock>

                                          <!-- Reason -->
                                          <TextBlock FontSize="11"
                                                    TextWrapping="Wrap">
                                            <Run Text="Reason: "
                                                FontWeight="SemiBold"
                                                Foreground="#ffb347" />
                                            <Run Text="{Binding Reason}"
                                                Foreground="#ffd47f" />
                                          </TextBlock>

                                          <!-- Cluster target if any -->
                                          <TextBlock FontSize="10"
                                                    Foreground="#9090B0"
                                                    IsVisible="{Binding HasClusterIndicator}">
                                            <Run Text="Clusters with: " />
                                            <Run Text="{Binding ClusterTarget}" FontWeight="SemiBold" />
                                          </TextBlock>
                                        </StackPanel>

                                    </Border>
                                  </DataTemplate>
                                </ListBox.ItemTemplate>
                              </ListBox>
                            </Grid>

                    <!-- Buttons -->
                    <StackPanel Grid.Row="4"
                                Orientation="Horizontal"
                                Spacing="8"
                                HorizontalAlignment="Left">
                      <Button x:Name="SweepCopyResultsButton"
                              Content="Copy Results"
                              Click="SweepCopyResultsButton_OnClick"/>
                      <Button x:Name="SweepSaveResultsButton"
                              Content="Save Snapshot"
                              Click="SweepSaveResultsButton_OnClick"/>
                      <Button x:Name="SweepAddToFocusButton"
                              Content="Add to focus"
                              Click="SweepAddToFocusButton_OnClick"/>
                      <Button x:Name="SweepAddToCaseButton"
                              Content="Add to case"
                              Click="SweepAddToCaseButton_OnClick"/>
                      <Button x:Name="SweepInvestigateButton"
                              Content="Investigate"
                              Click="SweepInvestigateButton_OnClick"/>
                      <Button x:Name="SweepOpenLocationButton"
                              Content="Open location"
                              Click="SweepOpenLocationButton_OnClick"/>
                    </StackPanel>

                  </Grid>
                </TabItem>



        <!-- CLEANUP -->
        <TabItem Header="Cleanup">
          <Border Background="#0B1518" Padding="16">
            <TextBlock Text="Cleanup tab shell — post-removal hygiene."
                       Foreground="#C7D4D4"
                       FontSize="16"
                       TextWrapping="Wrap" />
          </Border>
        </TabItem>

        <!-- HARDEN -->
        <TabItem Header="Harden">
          <Border Background="#0B1518" Padding="16">
            <TextBlock Text="Harden tab shell — Standard / Strict profiles with rollback."
                       Foreground="#C7D4D4"
                       FontSize="16"
                       TextWrapping="Wrap" />
          </Border>
        </TabItem>

                <!-- CASE -->
                <TabItem Header="Case">
                  <Border Background="#0B1518" Padding="16">
                    <StackPanel Orientation="Vertical" Spacing="12">

                      <!-- TITLE -->
                      <TextBlock Text="Case timeline"
                                FontSize="20"
                                FontWeight="SemiBold"
                                Foreground="#EAF7F7" />

                      <TextBlock Text="Everything that has happened in this incident: scans, findings, and actions. Export this log for your ticket or IR lead."
                                FontSize="13"
                                Foreground="#8FA9AA"
                                TextWrapping="Wrap" />

                     <!-- SUMMARY ROW -->
                    <Grid ColumnDefinitions="2*,*,*,*" Margin="0,8,0,0">
                      <!-- Case ID -->
                      <StackPanel Grid.Column="0"
                                  Spacing="2">
                        <TextBlock Text="Case ID"
                                  FontSize="11"
                                  Foreground="#8FA9AA" />
                        <TextBlock x:Name="CaseSummaryIdText"
                                  Text="(no case yet)"
                                  FontSize="13"
                                  Foreground="#C7D4D4"
                                  TextWrapping="Wrap" />
                      </StackPanel>

                      <!-- Host -->
                      <StackPanel Grid.Column="1"
                                  Spacing="2">
                        <TextBlock Text="Host"
                                  FontSize="11"
                                  Foreground="#8FA9AA" />
                        <TextBlock x:Name="CaseSummaryHostText"
                                  Text="(host)"
                                  FontSize="13"
                                  Foreground="#C7D4D4" />
                      </StackPanel>

                      <!-- User -->
                      <StackPanel Grid.Column="2"
                                  Spacing="2">
                        <TextBlock Text="User"
                                  FontSize="11"
                                  Foreground="#8FA9AA" />
                        <TextBlock x:Name="CaseSummaryUserText"
                                  Text="(user)"
                                  FontSize="13"
                                  Foreground="#C7D4D4" />
                      </StackPanel>

                      <!-- Started -->
                      <StackPanel Grid.Column="3"
                                  Spacing="2">
                        <TextBlock Text="Started"
                                  FontSize="11"
                                  Foreground="#8FA9AA" />
                        <TextBlock x:Name="CaseSummaryStartedText"
                                  Text="(time)"
                                  FontSize="13"
                                  Foreground="#C7D4D4" />
                      </StackPanel>
                    </Grid>

                                          <!-- CASE FOCUS ROW -->
                      <StackPanel Orientation="Horizontal"
                                  Spacing="8"
                                  Margin="0,12,0,0">
                        <TextBlock Text="Case focus:"
                                   VerticalAlignment="Center"
                                   Foreground="#8FA9AA" />
                        <TextBox x:Name="CaseFocusTextBox"
                                 Width="260"
                                 Watermark="File path, name, hash, etc." />
                        <Button Content="Set"
                                Width="70"
                                Click="CaseFocusSetButton_OnClick" />
                        <Button Content="Clear"
                                Width="70"
                                Click="CaseFocusClearButton_OnClick" />
                        <TextBlock x:Name="CaseFocusStatusText"
                                   Margin="12,0,0,0"
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="#8FA9AA"
                                   Text="Focus: (none)" />
                      </StackPanel>

                      <!-- BUTTONS -->
                      <StackPanel Orientation="Horizontal"
                                  Spacing="8"
                                  Margin="0,12,0,0">
                        <Button Content="Refresh"
                                Width="100"
                                Click="CaseRefreshButton_OnClick" />
                        <Button Content="Export case report"
                                Width="160"
                                Click="CaseExportButton_OnClick" />
                      </StackPanel>

                      <!-- EVENTS LIST -->
                      <Border Margin="0,12,0,0"
                              Background="#050E10"
                              Padding="8">
                          <ListBox x:Name="CaseEventsList"
                                  BorderThickness="0"
                                  Height="760"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto">
                          <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="models:CaseEvent">
                              <StackPanel Margin="0,4" Spacing="2">
                                <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}"
                                          FontSize="11"
                                          Foreground="#7FA3A4" />
                                <TextBlock>
                                  <Run Text="[" />
                                  <Run Text="{Binding Tab}" />
                                  <Run Text="] " />
                                  <Run Text="{Binding Severity}" />
                                  <Run Text=" – " />
                                  <Run Text="{Binding Action}" />
                                </TextBlock>
                                <TextBlock Text="{Binding Target}"
                                          FontSize="11"
                                          Foreground="#9FB9BA"
                                          TextWrapping="Wrap" />
                                <TextBlock Text="{Binding Details}"
                                          FontSize="11"
                                          Foreground="#9FB9BA"
                                          TextWrapping="Wrap" />
                              </StackPanel>
                            </DataTemplate>
                          </ListBox.ItemTemplate>
                        </ListBox>
                      </Border>

                    </StackPanel>
                  </Border>
                </TabItem>

        <!-- HELP -->
        <TabItem Header="Help">
          <Border Background="#0B1518" Padding="16">
            <TextBlock Text="Help tab shell — safety rules, shortcuts, and log locations."
                       Foreground="#C7D4D4"
                       FontSize="16"
                       TextWrapping="Wrap" />
          </Border>
        </TabItem>

      </TabControl>
    </Border>
  </Grid>
</Window>
