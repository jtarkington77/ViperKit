<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:ViperKit.UI.Models"
        x:Class="ViperKit.UI.Views.MainWindow"
        Width="1200"
        Height="750"
        Title="ViperKit"
        Icon="avares://ViperKit.UI/Assets/viperkit.ico"
        Background="#05090A">


  <Grid RowDefinitions="110,*">

    <!-- HEADER BAR -->
    <Border Grid.Row="0"
            Background="#070D0F"
            Padding="16,10"
            BorderBrush="#10191C"
            BorderThickness="0,0,0,2">
      <Grid ColumnDefinitions="Auto,*">

        <!-- LOGO -->
        <Image Grid.Column="0"
               Width="96"
               Height="96"
               Margin="0,0,16,0"
               Stretch="Uniform"
               Source="avares://ViperKit.UI/Assets/logo.png" />

        <!-- TITLE TEXT -->
        <StackPanel Grid.Column="1"
                    VerticalAlignment="Center"
                    Orientation="Vertical">
          <TextBlock Text="ViperKit"
                     FontSize="32"
                     FontWeight="Bold"
                     Foreground="#00FFF8" />
          <TextBlock Text="Incident Response Toolkit"
                     FontSize="14"
                     Foreground="#8FA9AA" />
        </StackPanel>

      </Grid>
    </Border>

    <!-- MAIN BODY -->
    <Border Grid.Row="1"
            Background="#05090A"
            Padding="12,8,12,12">

      <!-- SIMPLE TABS â€“ Avalonia defaults -->
      <TabControl x:Name="MainTabs" TabStripPlacement="Top" SelectionChanged="MainTabs_OnSelectionChanged">

                <!-- DASHBOARD -->
                <TabItem Header="Dashboard">
                  <Border Background="#0B1518" Padding="16">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                      <StackPanel Orientation="Vertical" Spacing="16">

                      <!-- TITLE -->
                      <TextBlock Text="Dashboard"
                                FontSize="20"
                                FontWeight="SemiBold"
                                Foreground="#EAF7F7" />

                      <TextBlock Text="High-level view of this host and the current incident case."
                                FontSize="13"
                                Foreground="#8FA9AA"
                                TextWrapping="Wrap" />

                      <!-- ADMIN WARNING BANNER (shown if NOT running as admin) -->
                      <Border x:Name="AdminWarningBanner"
                              Background="#2A0A0A"
                              Padding="12"
                              CornerRadius="6"
                              BorderBrush="#DD3333"
                              BorderThickness="3"
                              IsVisible="False">
                        <StackPanel Spacing="6">
                          <TextBlock Text="ðŸš« NOT RUNNING AS ADMINISTRATOR"
                                    FontSize="13"
                                    FontWeight="Bold"
                                    Foreground="#FF3333" />
                          <TextBlock FontSize="11"
                                    Foreground="#FFCCCC"
                                    TextWrapping="Wrap">
                            ViperKit is NOT running with administrator privileges! Most features will FAIL. Close this application and right-click the executable, then select "Run as Administrator". Registry scans, service management, scheduled tasks, and all remediation actions require admin rights.
                          </TextBlock>
                        </StackPanel>
                      </Border>

                      <!-- DISCLAIMER -->
                      <Border Background="#1A1A0A"
                              Padding="12"
                              CornerRadius="6"
                              BorderBrush="#4A4A16"
                              BorderThickness="1">
                        <StackPanel Spacing="6">
                          <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="IMPORTANT NOTICE"
                                      FontSize="12"
                                      FontWeight="Bold"
                                      Foreground="#FFCC66" />
                          </StackPanel>
                          <TextBlock FontSize="11"
                                    Foreground="#C0C0A0"
                                    TextWrapping="Wrap">
                            ViperKit is a forensic investigation and incident response tool designed to help identify and remediate threats on compromised systems. It is NOT an Endpoint Detection and Response (EDR) solution, antivirus, or real-time protection software. After using ViperKit to clean a system, continued monitoring with proper security tools is strongly recommended. Use at your own risk. Always verify findings and maintain backups before taking remediation actions.
                          </TextBlock>
                        </StackPanel>
                      </Border>

                      <!-- CASE SELECTION PANEL (shown before case is started) -->
                      <Border x:Name="CaseSelectionPanel"
                              Background="#050E10"
                              Padding="16"
                              CornerRadius="6"
                              BorderBrush="#1A4A3F"
                              BorderThickness="1"
                              IsVisible="True">
                        <StackPanel Spacing="12">
                          <TextBlock Text="Case Management"
                                    FontSize="16"
                                    FontWeight="SemiBold"
                                    Foreground="#00FFF8" />

                          <TextBlock Text="Start a new case or load an existing one to continue your investigation."
                                    FontSize="12"
                                    Foreground="#8FA9AA"
                                    TextWrapping="Wrap" />

                          <!-- New Case Section -->
                          <Border Background="#0A1518" Padding="12" CornerRadius="4">
                            <StackPanel Spacing="8">
                              <TextBlock Text="Start New Case"
                                        FontSize="13"
                                        FontWeight="SemiBold"
                                        Foreground="#99CC99" />
                              <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBox x:Name="NewCaseNameInput"
                                        Width="300"
                                        Watermark="Case name (optional, e.g., Ticket-12345)" />
                                <Button x:Name="StartNewCaseButton"
                                        Content="Start New Case"
                                        Click="StartNewCaseButton_OnClick"
                                        MinWidth="140"
                                        Background="#1E3D2A"
                                        Foreground="#99CC99" />
                              </StackPanel>
                              <TextBlock Text="Leave blank to auto-generate case ID from hostname + timestamp"
                                        FontSize="10"
                                        Foreground="#667"
                                        FontStyle="Italic" />
                            </StackPanel>
                          </Border>

                          <!-- Load Existing Case Section -->
                          <Border Background="#0A1518" Padding="12" CornerRadius="4">
                            <StackPanel Spacing="8">
                              <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="Load Existing Case"
                                          FontSize="13"
                                          FontWeight="SemiBold"
                                          Foreground="#66CCFF" />
                                <Button x:Name="RefreshCaseListButton"
                                        Content="Refresh"
                                        Click="RefreshCaseListButton_OnClick"
                                        Padding="8,2"
                                        FontSize="10" />
                              </StackPanel>

                              <ListBox x:Name="AvailableCasesList"
                                      Height="150"
                                      Background="#050A0C"
                                      SelectionChanged="AvailableCasesList_OnSelectionChanged">
                                <ListBox.ItemTemplate>
                                  <DataTemplate x:DataType="models:CaseSummary">
                                    <Border Padding="8" Margin="0,2" CornerRadius="4" Background="#0D1517">
                                      <Grid ColumnDefinitions="*,Auto">
                                        <StackPanel Grid.Column="0" Spacing="2">
                                          <TextBlock Text="{Binding DisplayName}"
                                                    FontWeight="SemiBold"
                                                    Foreground="#E7F2F2" />
                                          <TextBlock Text="{Binding DisplayInfo}"
                                                    FontSize="11"
                                                    Foreground="#8FA9AA" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                          <TextBlock Text="Baseline"
                                                    FontSize="10"
                                                    Foreground="#66CCFF"
                                                    IsVisible="{Binding HasBaseline}" />
                                          <Border Padding="6,2" CornerRadius="3"
                                                  Background="{Binding Status, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                            <TextBlock Text="{Binding Status}"
                                                      FontSize="10"
                                                      Foreground="#888" />
                                          </Border>
                                        </StackPanel>
                                      </Grid>
                                    </Border>
                                  </DataTemplate>
                                </ListBox.ItemTemplate>
                              </ListBox>

                              <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button x:Name="LoadSelectedCaseButton"
                                        Content="Load Selected Case"
                                        Click="LoadSelectedCaseButton_OnClick"
                                        MinWidth="150"
                                        IsEnabled="False"
                                        Background="#1A3A4A"
                                        Foreground="#66CCFF" />
                                <Button x:Name="DeleteSelectedCaseButton"
                                        Content="Delete Case"
                                        Click="DeleteSelectedCaseButton_OnClick"
                                        MinWidth="100"
                                        IsEnabled="False"
                                        Background="#3A1E2C"
                                        Foreground="#FF9999" />
                              </StackPanel>

                              <TextBlock x:Name="NoCasesText"
                                        Text="No existing cases found on this machine."
                                        FontSize="11"
                                        Foreground="#666"
                                        FontStyle="Italic"
                                        IsVisible="False" />
                            </StackPanel>
                          </Border>
                        </StackPanel>
                      </Border>

                      <!-- TWO-COLUMN LAYOUT: SYSTEM SNAPSHOT + CASE SUMMARY -->
                      <Grid ColumnDefinitions="*,*" ColumnSpacing="16">

                        <!-- SYSTEM SNAPSHOT CARD -->
                        <Border Grid.Column="0"
                                Background="#050E10"
                                Padding="12"
                                CornerRadius="6"
                                BorderBrush="#1A3C3F"
                                BorderThickness="1">
                          <StackPanel Spacing="6">
                            <TextBlock Text="System Snapshot"
                                      FontSize="14"
                                      FontWeight="SemiBold"
                                      Foreground="#EAF7F7" />
                            <TextBlock x:Name="SystemHostNameText"
                                      Text="Host: (loading...)"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />
                            <TextBlock x:Name="SystemUserText"
                                      Text="User: (loading...)"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />
                            <TextBlock x:Name="SystemOsText"
                                      Text="OS: (loading...)"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />
                          </StackPanel>
                        </Border>

                        <!-- CASE SUMMARY CARD -->
                        <Border Grid.Column="1"
                                Background="#050E10"
                                Padding="12"
                                CornerRadius="6"
                                BorderBrush="#1A3C3F"
                                BorderThickness="1">
                          <StackPanel Spacing="8">
                            <TextBlock Text="Current Case"
                                      FontSize="14"
                                      FontWeight="SemiBold"
                                      Foreground="#EAF7F7" />

                            <TextBlock x:Name="CaseIdText"
                                      Text="Case ID: (none)"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />

                            <TextBlock x:Name="CaseEventsCountText"
                                      Text="Events: 0"
                                      FontSize="13"
                                      Foreground="#C7D4D4" />

                            <TextBlock x:Name="CaseLastEventText"
                                      Text="Last: (no events yet)"
                                      FontSize="12"
                                      Foreground="#8FA9AA"
                                      TextWrapping="Wrap" />

                            <StackPanel Orientation="Horizontal"
                                        Spacing="8"
                                        Margin="0,8,0,0">
                              <Button x:Name="CaseExportButton"
                                      Content="Export Case Report"
                                      Width="160"
                                      Click="CaseExportButton_OnClick" />
                              <Button x:Name="CloseCaseButton"
                                      Content="Close Case"
                                      Width="100"
                                      Click="CloseCaseButton_OnClick" />
                            </StackPanel>
                          </StackPanel>
                        </Border>

                      </Grid>

                      <!-- BASELINE PANEL -->
                      <Border Background="#050E10"
                              Padding="12"
                              CornerRadius="6"
                              BorderBrush="#1A3C3F"
                              BorderThickness="1">
                        <StackPanel Spacing="10">
                          <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Baseline"
                                      FontSize="14"
                                      FontWeight="SemiBold"
                                      Foreground="#66CCFF" />
                            <TextBlock Text="System state snapshot for post-incident monitoring"
                                      FontSize="12"
                                      Foreground="#8FA9AA"
                                      VerticalAlignment="Center" />
                          </StackPanel>

                          <!-- Baseline Status -->
                          <Border x:Name="BaselineStatusBorder"
                                  Background="#0A1518"
                                  Padding="10"
                                  CornerRadius="4">
                            <Grid ColumnDefinitions="*,Auto">
                              <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock x:Name="BaselineStatusText"
                                          Text="No baseline captured"
                                          FontSize="12"
                                          Foreground="#AAAAAA" />
                                <TextBlock x:Name="BaselineDetailsText"
                                          Text="Capture a baseline after cleaning to monitor for reinfection."
                                          FontSize="11"
                                          Foreground="#667"
                                          TextWrapping="Wrap" />
                              </StackPanel>
                              <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <Button x:Name="CaptureBaselineButton"
                                        Content="Capture Baseline"
                                        Click="CaptureBaselineButton_OnClick"
                                        MinWidth="130"
                                        Background="#1A4A3A"
                                        Foreground="#88FFAA" />
                                <Button x:Name="CompareBaselineButton"
                                        Content="Compare to Baseline"
                                        Click="CompareBaselineButton_OnClick"
                                        MinWidth="150"
                                        IsEnabled="False" />
                              </StackPanel>
                            </Grid>
                          </Border>

                          <!-- Baseline Capture Info (shown after capture) -->
                          <Border x:Name="BaselineInfoPanel"
                                  Background="#0A1A20"
                                  Padding="10"
                                  CornerRadius="4"
                                  IsVisible="False">
                            <StackPanel Spacing="4">
                              <StackPanel Orientation="Horizontal" Spacing="16">
                                <TextBlock x:Name="BaselineCapturedAtText"
                                          Text="Captured: (date)"
                                          FontSize="11"
                                          Foreground="#99CC99" />
                                <TextBlock x:Name="BaselinePersistCountText"
                                          Text="Persist entries: 0"
                                          FontSize="11"
                                          Foreground="#C7D4D4" />
                                <TextBlock x:Name="BaselineHardenCountText"
                                          Text="Hardening applied: 0"
                                          FontSize="11"
                                          Foreground="#C7D4D4" />
                              </StackPanel>
                              <TextBlock Text="Use 'Compare to Baseline' to scan for new persistence entries added since baseline."
                                        FontSize="10"
                                        Foreground="#667"
                                        FontStyle="Italic" />
                            </StackPanel>
                          </Border>
                        </StackPanel>
                      </Border>

                      <!-- DEMO MODE PANEL -->
                      <Border Background="#0A1518"
                              Padding="12"
                              CornerRadius="6"
                              BorderBrush="#1A4A3F"
                              BorderThickness="1">
                        <StackPanel Spacing="12">
                          <!-- Demo Header -->
                          <Grid ColumnDefinitions="Auto,*,Auto">
                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                              <TextBlock Text="Demo Mode"
                                        FontSize="14"
                                        FontWeight="SemiBold"
                                        Foreground="#00FFFA" />
                              <TextBlock Text="Guided training walkthrough"
                                        FontSize="12"
                                        Foreground="#8FA9AA"
                                        VerticalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                              <Button x:Name="DemoStartButton"
                                      Content="Start Demo"
                                      Click="DemoStartButton_OnClick"
                                      MinWidth="100"
                                      Background="#1A4A3A"
                                      Foreground="#88FFAA" />
                              <Button x:Name="DemoEndButton"
                                      Content="End Demo"
                                      Click="DemoEndButton_OnClick"
                                      MinWidth="100"
                                      IsEnabled="False"
                                      Background="#4A2A2A"
                                      Foreground="#FFAAAA" />
                            </StackPanel>
                          </Grid>

                          <!-- Demo Description (shown when not active) -->
                          <TextBlock Text="Learn ViperKit with a guided walkthrough using harmless test artifacts. Creates demo files, registry keys, and scheduled task, then walks you through Hunt, Persist, Sweep, and Cleanup. Perfect for training and proof-of-concept."
                                    FontSize="11"
                                    Foreground="#6A8A8B"
                                    TextWrapping="Wrap" />

                          <!-- Demo Status -->
                          <TextBlock x:Name="DemoStatusText"
                                    Text="Status: Ready to start demo"
                                    FontSize="11"
                                    Foreground="#8FA9AA" />

                          <!-- Walkthrough Panel (visible when demo active) -->
                          <Border x:Name="DemoWalkthroughPanel"
                                  Background="#050D10"
                                  Padding="12"
                                  CornerRadius="4"
                                  BorderBrush="#1A3A4A"
                                  BorderThickness="1"
                                  IsVisible="False">
                            <StackPanel Spacing="10">
                              <!-- Progress -->
                              <Grid ColumnDefinitions="Auto,*,Auto">
                                <TextBlock x:Name="DemoStepIndicator"
                                          Grid.Column="0"
                                          Text="Step 1 of 6"
                                          FontSize="11"
                                          Foreground="#00FFFA"
                                          FontWeight="Bold" />
                                <ProgressBar x:Name="DemoProgressBar"
                                            Grid.Column="1"
                                            Margin="12,0"
                                            Minimum="0"
                                            Maximum="6"
                                            Value="1"
                                            Height="6" />
                                <Button x:Name="DemoViewArtifactsButton"
                                        Grid.Column="2"
                                        Content="View Artifacts"
                                        Click="DemoViewArtifactsButton_OnClick"
                                        FontSize="10"
                                        Padding="8,2" />
                              </Grid>

                              <!-- Step Title -->
                              <TextBlock x:Name="DemoStepTitle"
                                        Text=""
                                        FontSize="14"
                                        FontWeight="SemiBold"
                                        Foreground="#EAF7F7" />

                              <!-- Instructions -->
                              <TextBlock x:Name="DemoInstructions"
                                        Text=""
                                        FontSize="12"
                                        Foreground="#C7D4D4"
                                        TextWrapping="Wrap" />

                              <!-- Expected Findings -->
                              <Border Background="#0A1A20" Padding="8" CornerRadius="3">
                                <StackPanel>
                                  <TextBlock Text="What you should find:"
                                            FontSize="10"
                                            FontWeight="Bold"
                                            Foreground="#88AACC" />
                                  <TextBlock x:Name="DemoExpectedFindings"
                                            Text=""
                                            FontSize="11"
                                            Foreground="#AACCDD"
                                            TextWrapping="Wrap"
                                            Margin="0,4,0,0" />
                                </StackPanel>
                              </Border>

                              <!-- Tip -->
                              <TextBlock FontSize="11" Foreground="#FFB347" TextWrapping="Wrap">
                                <Run Text="Tip: " FontWeight="Bold" />
                                <Run x:Name="DemoTip" Text="" />
                              </TextBlock>

                              <!-- Action -->
                              <TextBlock x:Name="DemoAction"
                                        Text=""
                                        FontSize="11"
                                        Foreground="#88FF88"
                                        FontWeight="SemiBold" />

                              <!-- Learning Point -->
                              <TextBlock FontSize="10" Foreground="#8899AA" TextWrapping="Wrap" FontStyle="Italic">
                                <Run x:Name="DemoLearningPoint" Text="" />
                              </TextBlock>

                              <!-- Navigation -->
                              <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                                <Button x:Name="DemoPrevButton"
                                        Content="Previous"
                                        Click="DemoPrevButton_OnClick"
                                        MinWidth="80"
                                        IsEnabled="False" />
                                <Button x:Name="DemoGoToTabButton"
                                        Content="Go to Hunt tab"
                                        Click="DemoGoToTabButton_OnClick"
                                        MinWidth="120"
                                        Background="#1A3A4A" />
                                <Button x:Name="DemoCopySearchButton"
                                        Content="Copy Search Term"
                                        Click="DemoCopySearchButton_OnClick"
                                        MinWidth="120" />
                                <Button x:Name="DemoNextButton"
                                        Content="Next Step"
                                        Click="DemoNextButton_OnClick"
                                        MinWidth="100"
                                        Background="#1A4A3A"
                                        Foreground="#88FFAA" />
                              </StackPanel>
                            </StackPanel>
                          </Border>

                          <!-- Artifacts Panel (collapsible) -->
                          <Border x:Name="DemoArtifactsPanel"
                                  Background="#050D10"
                                  Padding="8"
                                  CornerRadius="4"
                                  BorderBrush="#333"
                                  BorderThickness="1"
                                  IsVisible="False">
                            <StackPanel Spacing="4">
                              <TextBlock Text="Demo Artifacts Created:"
                                        FontSize="11"
                                        FontWeight="Bold"
                                        Foreground="#AABBCC" />
                              <ItemsControl x:Name="DemoArtifactsList">
                                <ItemsControl.ItemTemplate>
                                  <DataTemplate x:DataType="models:DemoArtifact">
                                    <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,2">
                                      <TextBlock Text="{Binding StatusIcon}"
                                                FontSize="10"
                                                Width="12" />
                                      <TextBlock Text="{Binding TypeIcon}"
                                                FontSize="10"
                                                Width="16" />
                                      <TextBlock Text="{Binding Name}"
                                                FontSize="10"
                                                Foreground="#AABBCC"
                                                Width="120" />
                                      <TextBlock Text="{Binding Description}"
                                                FontSize="9"
                                                Foreground="#778899"
                                                TextTrimming="CharacterEllipsis" />
                                    </StackPanel>
                                  </DataTemplate>
                                </ItemsControl.ItemTemplate>
                              </ItemsControl>
                            </StackPanel>
                          </Border>
                        </StackPanel>
                      </Border>

                      <!-- DASHBOARD STATUS / MESSAGES -->
                      <TextBlock x:Name="DashboardStatusText"
                                Text="Status: case initialising..."
                                FontSize="12"
                                Foreground="#8FA9AA"
                                TextWrapping="Wrap" />
                      </StackPanel>
                    </ScrollViewer>
                  </Border>
                </TabItem>

                <!-- HUNT -->
                <TabItem Header="Hunt">
                  <Border Background="#0B1518" Padding="16">
                    <!-- Use Grid for proper layout control with scrolling -->
                    <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,*" RowSpacing="8">

                      <!-- Title -->
                      <TextBlock Grid.Row="0"
                                Text="Step 1 â€“ Hunt the thing you stopped"
                                FontSize="16"
                                FontWeight="SemiBold"
                                Foreground="#EAF7F7" />

                      <!-- Description -->
                      <TextBlock Grid.Row="1"
                                Text="Start from the suspicious file, domain, hash, or IOC you found. DON'T remove it yet - add it to the case first to document it, then we'll carry it forward as the case focus."
                                FontSize="12"
                                Foreground="#8FA9AA"
                                TextWrapping="Wrap" />

                      <!-- IOC input + type + run -->
                      <StackPanel Grid.Row="2"
                                  Orientation="Vertical"
                                  Spacing="8">

                        <!-- Recent searches dropdown -->
                        <StackPanel Orientation="Horizontal" Spacing="8">
                          <TextBlock Text="Recent searches:"
                                    FontSize="11"
                                    Foreground="#8FA9AA"
                                    VerticalAlignment="Center" />
                          <ComboBox x:Name="HuntHistoryDropdown"
                                    Width="520"
                                    SelectionChanged="HuntHistoryDropdown_OnSelectionChanged"
                                    PlaceholderText="Select from recent IOC searches..." />
                        </StackPanel>

                        <!-- Current IOC input row -->
                        <StackPanel Orientation="Horizontal" Spacing="8">
                          <TextBox x:Name="HuntIocInput"
                                  Width="420"
                                  Watermark="Paste path, hash, domain, IP, registry key..." />

                        <ComboBox x:Name="HuntIocType"
                                  Width="170"
                                  SelectedIndex="0">
                          <ComboBoxItem Content="Auto"      />
                          <ComboBoxItem Content="File path" />
                          <ComboBoxItem Content="Hash"      />
                          <ComboBoxItem Content="Domain/URL"/>
                          <ComboBoxItem Content="IP address"/>
                          <ComboBoxItem Content="Registry"  />
                        </ComboBox>

                        <Button x:Name="HuntRunButton"
                                Content="Run Hunt"
                                Width="110"
                                Click="HuntRunButton_OnClick" />

                        <Button x:Name="HuntSetCaseFocusButton"
                                Content="Set as case focus"
                                Width="150"
                                Click="HuntSetCaseFocusButton_OnClick" />
                        </StackPanel>
                      </StackPanel>

                      <!-- Scope folder + Status + Buttons in one row -->
                      <Grid Grid.Row="3" ColumnDefinitions="*" RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                        <!-- Status line -->
                        <TextBlock Grid.Row="0"
                                  x:Name="HuntStatusText"
                                  Text="Status: idle."
                                  Foreground="#C7D4D4" />

                        <!-- Scope folder row -->
                        <StackPanel Grid.Row="1"
                                    Orientation="Horizontal"
                                    Spacing="8">
                          <TextBlock Text="Scope folder:"
                                    VerticalAlignment="Center"
                                    Foreground="#C7D4D4" />
                          <TextBox x:Name="HuntScopeFolderInput"
                                  Width="420"
                                  Watermark="Optional: folder to scan for matching files" />
                          <Button x:Name="HuntBrowseScopeButton"
                                  Content="Browse..."
                                  Width="100"
                                  Click="HuntBrowseScopeButton_OnClick" />
                        </StackPanel>

                        <!-- Action buttons -->
                        <StackPanel Grid.Row="2"
                                    Orientation="Horizontal"
                                    Spacing="8">
                          <Button x:Name="HuntCopyResultsButton"
                                  Content="Copy Results"
                                  Width="120"
                                  Click="HuntCopyResultsButton_OnClick" />
                          <Button x:Name="HuntSaveResultsButton"
                                  Content="Save Snapshot"
                                  Width="130"
                                  Click="HuntSaveResultsButton_OnClick" />
                          <Button x:Name="HuntClearButton"
                                  Content="Clear"
                                  Width="80"
                                  Click="HuntClearButton_OnClick" />
                        </StackPanel>
                      </Grid>

                      <!-- Text results area -->
                      <TextBox Grid.Row="4"
                              x:Name="HuntResultsText"
                              AcceptsReturn="True"
                              IsReadOnly="True"
                              TextWrapping="Wrap"
                              FontFamily="Consolas"
                              Background="#05090A"
                              Foreground="#E4F3F3"
                              MinHeight="100"
                              MaxHeight="200" />

                      <!-- Structured results list with ScrollViewer -->
                      <Border Grid.Row="5"
                              Background="#050E10"
                              Padding="8">
                        <Grid RowDefinitions="Auto,*,Auto">
                          <TextBlock Grid.Row="0"
                                    Text="Matches"
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                    Foreground="#EAF7F7"
                                    Margin="0,0,0,8" />

                          <!-- ListBox with proper scrolling -->
                          <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                            <ListBox x:Name="HuntResultsList"
                                    BorderThickness="0"
                                    Background="Transparent">
                              <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="models:HuntResult">
                                  <Border Margin="0,4,0,4"
                                          Padding="6"
                                          Background="#07161A"
                                          CornerRadius="4">
                                    <StackPanel Spacing="2">
                                      <TextBlock>
                                        <Run Text="[" />
                                        <Run Text="{Binding Category}" />
                                        <Run Text="] " />
                                        <Run Text="{Binding Severity}" />
                                        <Run Text=" â€“ " />
                                        <Run Text="{Binding Summary}" />
                                      </TextBlock>
                                      <TextBlock Text="{Binding Target}"
                                                FontSize="11"
                                                Foreground="#9FB9BA"
                                                TextWrapping="Wrap" />
                                      <TextBlock Text="{Binding Details}"
                                                FontSize="11"
                                                Foreground="#7FA3A4"
                                                TextWrapping="Wrap" />
                                    </StackPanel>
                                  </Border>
                                </DataTemplate>
                              </ListBox.ItemTemplate>
                            </ListBox>
                          </ScrollViewer>

                          <!-- Buttons at bottom -->
                          <StackPanel Grid.Row="2"
                                      Orientation="Horizontal"
                                      Spacing="8"
                                      Margin="0,8,0,0">
                            <Button Content="Open location"
                                    Width="120"
                                    Click="HuntOpenLocationButton_OnClick" />
                            <Button Content="Copy target"
                                    Width="120"
                                    Click="HuntCopyTargetButton_OnClick" />
                          </StackPanel>
                        </Grid>
                      </Border>

                    </Grid>
                  </Border>
                </TabItem>

                <!-- PERSIST -->
                <TabItem Header="Persist">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Header / Run -->
                    <StackPanel Grid.Row="0"
                                Orientation="Horizontal"
                                Spacing="8"
                                VerticalAlignment="Center">
                        <TextBlock Text="Persistence map"
                                  FontSize="16"
                                  FontWeight="Bold"
                                  Margin="0,0,8,0" />

                        <Button x:Name="PersistRunButton"
                                Content="Run persistence scan"
                                Click="PersistRunButton_OnClick"
                                MinWidth="180"
                                Margin="0,0,8,0" />

                        <TextBlock x:Name="PersistStatusText"
                                  Text="Status: idle."
                                  VerticalAlignment="Center"
                                  TextWrapping="Wrap" />
                    </StackPanel>

                    <!-- Summary / Triage Panel -->
                    <Border Grid.Row="1"
                            Background="#0A1214"
                            CornerRadius="6"
                            Padding="12"
                            Margin="0,12,0,0"
                            BorderBrush="#1A3C3F"
                            BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="24">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#5A1E2C" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistHighSignalCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#FF9999" />
                                </Border>
                                <TextBlock Text="High-signal"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#5A1E2C" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistCheckCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#FF9999" />
                                </Border>
                                <TextBlock Text="CHECK"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#4A3D16" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistNoteCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#FFCC66" />
                                </Border>
                                <TextBlock Text="NOTE"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#1E3D2A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistOkCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#99CC99" />
                                </Border>
                                <TextBlock Text="OK"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Border Background="#2A3A5A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                    <TextBlock x:Name="PersistFocusMatchCount"
                                              Text="0"
                                              FontWeight="Bold"
                                              HorizontalAlignment="Center"
                                              Foreground="#99CCFF" />
                                </Border>
                                <TextBlock Text="Match focus"
                                          VerticalAlignment="Center"
                                          Foreground="#C7D4D4" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                   <!-- Filters row -->
                  <StackPanel Grid.Row="2"
                              Orientation="Horizontal"
                              Spacing="12"
                              Margin="0,12,0,8">

                    <!-- Show only CHECK entries -->
                    <CheckBox x:Name="PersistShowCheckOnlyCheckBox"
                              Content="Show only 'CHECK' entries"
                              VerticalAlignment="Center"
                              Checked="PersistFilterCheckBox_OnChanged"
                              Unchecked="PersistFilterCheckBox_OnChanged" />

                    <!-- Filter by case focus -->
                    <CheckBox x:Name="PersistFilterByFocusCheckBox"
                              Content="Filter by case focus"
                              Margin="12,0,0,0"
                              VerticalAlignment="Center"
                              Foreground="#8FA9AA"
                              IsChecked="False"
                              Checked="PersistFilterCheckBox_OnChanged"
                              Unchecked="PersistFilterCheckBox_OnChanged" />

                    <!-- risk / triage mode -->
                    <ComboBox x:Name="PersistRiskFilterCombo"
                              Width="170"
                              SelectedIndex="0"
                              SelectionChanged="PersistRiskFilterCombo_OnSelectionChanged">
                      <ComboBoxItem>All severities</ComboBoxItem>
                      <ComboBoxItem>High-signal hotspots</ComboBoxItem>
                      <ComboBoxItem>CHECK only</ComboBoxItem>
                      <ComboBoxItem>Notes &amp; OK</ComboBoxItem>
                    </ComboBox>

                    <ComboBox x:Name="PersistLocationFilterCombo"
                              Width="180"
                              SelectionChanged="PersistLocationFilterCombo_OnSelectionChanged">
                      <ComboBoxItem>All locations</ComboBoxItem>
                      <ComboBoxItem>Registry autoruns</ComboBoxItem>
                      <ComboBoxItem>Startup folders</ComboBoxItem>
                      <ComboBoxItem>Services / drivers</ComboBoxItem>
                      <ComboBoxItem>Scheduled tasks</ComboBoxItem>
                    </ComboBox>

                    <TextBox x:Name="PersistSearchTextBox"
                            Width="260"
                            Watermark="Search name, path, source, reason..."
                            TextChanged="PersistSearchTextBox_OnTextChanged" />
                  </StackPanel>

                   <!-- Results + detail -->
                  <Grid Grid.Row="3"
                        ColumnDefinitions="2*,*">
                    <!-- List -->
                    <ListBox x:Name="PersistResultsList"
                            Grid.Column="0"
                            Margin="0,0,8,0"
                            DoubleTapped="PersistResultsList_OnDoubleTapped">
                      <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="models:PersistItem">
                          <Border Padding="8"
                                  Margin="0,0,0,4"
                                  CornerRadius="4"
                                  Background="#0D1517"
                                  BorderThickness="{Binding FocusBorderThickness}"
                                  BorderBrush="{Binding FocusBorderBrush}">
                            <StackPanel Spacing="2">
                              <!-- Top line: Risk badge + NEW badge + location/source -->
                              <StackPanel Orientation="Horizontal"
                                          Spacing="8">
                                <Border Padding="6,2"
                                        CornerRadius="3"
                                        Background="{Binding RiskBackground}">
                                  <TextBlock Text="{Binding Risk}"
                                            FontSize="11"
                                            FontWeight="SemiBold" />
                                </Border>

                                <!-- NEW since baseline badge -->
                                <Border Padding="6,2"
                                        CornerRadius="3"
                                        Background="#5A2A1E"
                                        IsVisible="{Binding ShowBaselineBadge}">
                                  <TextBlock Text="NEW"
                                            FontSize="10"
                                            FontWeight="Bold"
                                            Foreground="#FF9966" />
                                </Border>

                                <TextBlock FontSize="11">
                                  <Run Text="{Binding LocationType}" />
                                  <Run Text=" â€¢ " />
                                  <Run Text="{Binding Source}" />
                                </TextBlock>
                              </StackPanel>

                              <!-- Name -->
                              <TextBlock Text="{Binding Name}"
                                        FontWeight="SemiBold"
                                        Margin="0,4,0,0" />

                              <!-- Path / RegistryPath (truncated) -->
                              <TextBlock Text="{Binding Path}"
                                        FontSize="11"
                                        TextTrimming="CharacterEllipsis" />
                              <TextBlock Text="{Binding RegistryPath}"
                                        FontSize="11"
                                        TextTrimming="CharacterEllipsis" />

                              <!-- Reason -->
                              <TextBlock Text="{Binding Reason}"
                                        FontSize="11"
                                        Margin="0,4,0,0"
                                        TextWrapping="Wrap" />

                              <!-- MITRE -->
                              <TextBlock Text="{Binding MitreTechnique}"
                                        FontSize="10"
                                        Foreground="#FFAAAAAA" />
                            </StackPanel>
                          </Border>
                        </DataTemplate>
                      </ListBox.ItemTemplate>

                    </ListBox>

                        <!-- Detail pane (bound to selected item) -->
                        <Border Grid.Column="1"
                                Padding="8"
                                CornerRadius="4"
                                BorderThickness="1"
                                BorderBrush="#333">
                            <StackPanel DataContext="{Binding SelectedItem, ElementName=PersistResultsList}"
                                        x:DataType="models:PersistItem"
                                        Spacing="4">
                                <TextBlock Text="Selected entry"
                                          FontWeight="Bold"
                                          Margin="0,0,0,4" />

                                <TextBlock Text="{Binding Name}"
                                          FontSize="14"
                                          FontWeight="SemiBold" />

                                <TextBlock Text="{Binding Risk}"
                                          FontSize="12" />

                                <TextBlock Text="{Binding LocationType}" />
                                <TextBlock Text="{Binding Source}" />

                                <TextBlock Text="Path:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding Path}"
                                          FontSize="11"
                                          TextWrapping="Wrap" />

                                <TextBlock Text="Registry path:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding RegistryPath}"
                                          FontSize="11"
                                          TextWrapping="Wrap" />

                                <TextBlock Text="Reason:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding Reason}"
                                          FontSize="11"
                                          TextWrapping="Wrap" />

                                <TextBlock Text="MITRE technique:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding MitreTechnique}"
                                          FontSize="11" />

                                <TextBlock Text="Publisher:"
                                          Margin="0,6,0,0"
                                          FontWeight="SemiBold"
                                          FontSize="11" />
                                <TextBlock Text="{Binding Publisher}"
                                          FontSize="11"
                                          TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                    </Grid>

                    <!-- PowerShell History Section -->
                    <Expander Grid.Row="4"
                              Header="PowerShell History Analysis"
                              Margin="0,8,0,0"
                              IsExpanded="False">
                      <Border Background="#0A1214"
                              CornerRadius="6"
                              Padding="12"
                              Margin="0,8,0,0"
                              BorderBrush="#1A3C3F"
                              BorderThickness="1">
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto,200,Auto">

                          <!-- PS History Header / Scan Button -->
                          <StackPanel Grid.Row="0"
                                      Orientation="Horizontal"
                                      Spacing="8">
                            <Button x:Name="PSHistoryScanButton"
                                    Content="Scan PowerShell History"
                                    Click="PSHistoryScanButton_OnClick"
                                    MinWidth="180" />
                            <TextBlock x:Name="PSHistoryStatusText"
                                      Text="Status: idle."
                                      VerticalAlignment="Center"
                                      Foreground="#8FA9AA" />
                          </StackPanel>

                          <!-- PS History Summary Panel -->
                          <StackPanel Grid.Row="1"
                                      Orientation="Horizontal"
                                      Spacing="16"
                                      Margin="0,12,0,0">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                              <Border Background="#5A1E2C" CornerRadius="3" Padding="8,4" MinWidth="32">
                                <TextBlock x:Name="PSHistoryHighCount"
                                          Text="0"
                                          FontWeight="Bold"
                                          HorizontalAlignment="Center"
                                          Foreground="#FF9999" />
                              </Border>
                              <TextBlock Text="HIGH"
                                        VerticalAlignment="Center"
                                        Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                              <Border Background="#4A3D16" CornerRadius="3" Padding="8,4" MinWidth="32">
                                <TextBlock x:Name="PSHistoryMediumCount"
                                          Text="0"
                                          FontWeight="Bold"
                                          HorizontalAlignment="Center"
                                          Foreground="#FFCC66" />
                              </Border>
                              <TextBlock Text="MEDIUM"
                                        VerticalAlignment="Center"
                                        Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                              <Border Background="#1E3D2A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                <TextBlock x:Name="PSHistoryLowCount"
                                          Text="0"
                                          FontWeight="Bold"
                                          HorizontalAlignment="Center"
                                          Foreground="#99CC99" />
                              </Border>
                              <TextBlock Text="LOW"
                                        VerticalAlignment="Center"
                                        Foreground="#C7D4D4" />
                            </StackPanel>

                            <Border Background="#222" Width="1" Height="20" VerticalAlignment="Center" />

                            <StackPanel Orientation="Horizontal" Spacing="6">
                              <Border Background="#1A2A4A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                <TextBlock x:Name="PSHistoryPS51Count"
                                          Text="0"
                                          FontWeight="Bold"
                                          HorizontalAlignment="Center"
                                          Foreground="#88AADD" />
                              </Border>
                              <TextBlock Text="PS 5.1"
                                        VerticalAlignment="Center"
                                        Foreground="#C7D4D4" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                              <Border Background="#1A4A2A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                <TextBlock x:Name="PSHistoryPS7Count"
                                          Text="0"
                                          FontWeight="Bold"
                                          HorizontalAlignment="Center"
                                          Foreground="#88DDAA" />
                              </Border>
                              <TextBlock Text="PS 7"
                                        VerticalAlignment="Center"
                                        Foreground="#C7D4D4" />
                            </StackPanel>

                            <Border Background="#222" Width="1" Height="20" VerticalAlignment="Center" />

                            <StackPanel Orientation="Horizontal" Spacing="6">
                              <Border Background="#2A3A5A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                <TextBlock x:Name="PSHistoryUsersCount"
                                          Text="0"
                                          FontWeight="Bold"
                                          HorizontalAlignment="Center"
                                          Foreground="#99CCFF" />
                              </Border>
                              <TextBlock Text="Users"
                                        VerticalAlignment="Center"
                                        Foreground="#C7D4D4" />
                            </StackPanel>
                          </StackPanel>

                          <!-- PS History Filters Row 1 -->
                          <StackPanel Grid.Row="2"
                                      Orientation="Horizontal"
                                      Spacing="10"
                                      Margin="0,12,0,4">
                            <CheckBox x:Name="PSHistoryShowSuspiciousCheckBox"
                                      Content="Suspicious only"
                                      IsChecked="True"
                                      Checked="PSHistoryFilterChanged"
                                      Unchecked="PSHistoryFilterChanged" />

                            <ComboBox x:Name="PSHistoryVersionFilterCombo"
                                      Width="130"
                                      SelectedIndex="0"
                                      SelectionChanged="PSHistoryVersionFilterCombo_OnSelectionChanged">
                              <ComboBoxItem>All Versions</ComboBoxItem>
                              <ComboBoxItem>PowerShell 5.1</ComboBoxItem>
                              <ComboBoxItem>PowerShell 7</ComboBoxItem>
                            </ComboBox>

                            <ComboBox x:Name="PSHistorySeverityFilterCombo"
                                      Width="120"
                                      SelectedIndex="0"
                                      SelectionChanged="PSHistorySeverityFilterCombo_OnSelectionChanged">
                              <ComboBoxItem>All Severities</ComboBoxItem>
                              <ComboBoxItem>HIGH only</ComboBoxItem>
                              <ComboBoxItem>MEDIUM only</ComboBoxItem>
                              <ComboBoxItem>LOW only</ComboBoxItem>
                            </ComboBox>

                            <ComboBox x:Name="PSHistoryUserFilterCombo"
                                      Width="120"
                                      SelectedIndex="0"
                                      SelectionChanged="PSHistoryUserFilterCombo_OnSelectionChanged">
                              <ComboBoxItem>All Users</ComboBoxItem>
                            </ComboBox>

                            <ComboBox x:Name="PSHistoryRecencyFilterCombo"
                                      Width="130"
                                      SelectedIndex="0"
                                      SelectionChanged="PSHistoryRecencyFilterCombo_OnSelectionChanged">
                              <ComboBoxItem>All Commands</ComboBoxItem>
                              <ComboBoxItem>Last 100</ComboBoxItem>
                              <ComboBoxItem>Last 500</ComboBoxItem>
                              <ComboBoxItem>Last 1000</ComboBoxItem>
                              <ComboBoxItem>Recent (last 10%)</ComboBoxItem>
                            </ComboBox>

                            <TextBox x:Name="PSHistorySearchBox"
                                    Width="180"
                                    Watermark="Search commands..."
                                    TextChanged="PSHistorySearchBox_OnTextChanged" />

                            <TextBlock x:Name="PSHistoryFilterStatus"
                                      Text=""
                                      VerticalAlignment="Center"
                                      Foreground="#8FA9AA"
                                      FontSize="11" />
                          </StackPanel>

                          <!-- PS History Tip -->
                          <TextBlock Grid.Row="3"
                                    Text="Note: PSReadLine history doesn't store timestamps per command. 'File modified' shows when PowerShell was last used. Line position indicates recency (higher = more recent). Use 'Last N' filter to focus on recent commands."
                                    FontSize="11"
                                    Foreground="#6A8A8B"
                                    TextWrapping="Wrap"
                                    Margin="0,0,0,8" />

                          <!-- PS History Results List -->
                          <ListBox Grid.Row="4"
                                  x:Name="PSHistoryResultsList"
                                  Background="#05090A">
                            <ListBox.ItemTemplate>
                              <DataTemplate x:DataType="models:PowerShellHistoryEntry">
                                <Border Padding="8"
                                        Margin="0,0,0,4"
                                        CornerRadius="4"
                                        Background="#0A1418"
                                        BorderThickness="{Binding BorderThickness}"
                                        BorderBrush="{Binding BorderBrush}">
                                  <StackPanel Spacing="4">
                                    <!-- Top line: Severity + User + PS Version + Position + Date -->
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                      <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                        <Border Padding="6,2"
                                                CornerRadius="3"
                                                Background="{Binding SeverityBackground}">
                                          <TextBlock Text="{Binding Severity}"
                                                    FontSize="10"
                                                    FontWeight="Bold"
                                                    Foreground="{Binding SeverityForeground}" />
                                        </Border>
                                        <TextBlock Text="{Binding SourceLabel}"
                                                  FontSize="11"
                                                  Foreground="#8FA9AA"
                                                  VerticalAlignment="Center" />
                                        <Border Padding="4,2"
                                                CornerRadius="3"
                                                Background="#1A2A3A">
                                          <TextBlock Text="{Binding RecencyLabel}"
                                                    FontSize="9"
                                                    Foreground="#7799BB" />
                                        </Border>
                                      </StackPanel>
                                      <TextBlock Grid.Column="2"
                                                Text="{Binding PositionLabel}"
                                                FontSize="10"
                                                Foreground="#667788"
                                                VerticalAlignment="Center" />
                                    </Grid>

                                    <!-- Command -->
                                    <TextBlock Text="{Binding CommandPreview}"
                                              FontSize="12"
                                              FontFamily="Consolas"
                                              Foreground="#E0F0F0"
                                              TextWrapping="Wrap" />

                                    <!-- Risk Reason -->
                                    <TextBlock FontSize="11"
                                              Foreground="#FFB347"
                                              TextWrapping="Wrap"
                                              IsVisible="{Binding RiskReason, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                      <Run Text="Risk: " FontWeight="SemiBold" />
                                      <Run Text="{Binding RiskReason}" />
                                    </TextBlock>

                                    <!-- Decoded Command (if encoded) -->
                                    <Border Background="#1A2A30"
                                            Padding="6"
                                            CornerRadius="3"
                                            IsVisible="{Binding HasDecodedCommand}">
                                      <StackPanel>
                                        <TextBlock Text="Decoded:"
                                                  FontSize="10"
                                                  FontWeight="Bold"
                                                  Foreground="#99CC99" />
                                        <TextBlock Text="{Binding DecodedCommand}"
                                                  FontSize="11"
                                                  FontFamily="Consolas"
                                                  Foreground="#B0E0B0"
                                                  TextWrapping="Wrap" />
                                      </StackPanel>
                                    </Border>

                                    <!-- File info line -->
                                    <TextBlock Text="{Binding FileModifiedLabel}"
                                              FontSize="9"
                                              Foreground="#556666"
                                              Margin="0,2,0,0" />
                                  </StackPanel>
                                </Border>
                              </DataTemplate>
                            </ListBox.ItemTemplate>
                          </ListBox>

                          <!-- PS History Actions -->
                          <StackPanel Grid.Row="5"
                                      Orientation="Horizontal"
                                      Spacing="8"
                                      Margin="0,8,0,0">
                            <Button x:Name="PSHistoryCopySelectedButton"
                                    Content="Copy Selected"
                                    Click="PSHistoryCopySelectedButton_OnClick"
                                    MinWidth="110" />
                            <Button x:Name="PSHistoryAddToCaseButton"
                                    Content="Add to Case"
                                    Click="PSHistoryAddToCaseButton_OnClick"
                                    MinWidth="100" />
                            <Button x:Name="PSHistoryDecodeButton"
                                    Content="Copy Decoded"
                                    Click="PSHistoryDecodeButton_OnClick"
                                    MinWidth="110" />
                            <Button x:Name="PSHistoryExportButton"
                                    Content="Export All"
                                    Click="PSHistoryExportButton_OnClick"
                                    MinWidth="100" />
                          </StackPanel>

                        </Grid>
                      </Border>
                    </Expander>

                    <!-- Footer - Button order: Copy, Save, Case, Focus, Investigate, Open, Cleanup -->
                    <StackPanel Grid.Row="5"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left"
                                Margin="0,8,0,0"
                                Spacing="8">
                        <Button x:Name="PersistCopyResultsButton"
                                Content="Copy results"
                                MinWidth="100"
                                Click="PersistCopyResultsButton_OnClick" />
                        <Button x:Name="PersistSaveResultsButton"
                                Content="Save snapshot"
                                MinWidth="100"
                                Click="PersistSaveResultsButton_OnClick" />
                        <Button x:Name="PersistAddToCaseButton"
                                Content="Add to case"
                                MinWidth="100"
                                Click="PersistAddToCaseButton_OnClick" />
                        <Button x:Name="PersistSetFocusButton"
                                Content="Set as focus"
                                MinWidth="100"
                                Click="PersistSetFocusButton_OnClick" />
                        <Button x:Name="PersistOpenSelectedButton"
                                Content="Investigate"
                                MinWidth="100"
                                Click="PersistOpenSelectedButton_OnClick" />
                        <Button x:Name="PersistAddToCleanupButton"
                                Content="Add to Cleanup"
                                MinWidth="110"
                                Click="PersistAddToCleanupButton_OnClick"
                                Background="#4A3D16"
                                Foreground="#FFCC66" />
                    </StackPanel>

                </Grid>
            </TabItem>


                <!-- SWEEP -->
                <TabItem Header="Sweep">
                  <Grid Margin="16"
                        RowDefinitions="Auto,Auto,Auto,*,Auto"
                        RowSpacing="8">

                    <!-- Title -->
                    <TextBlock Grid.Row="0"
                              Text="Sweep â€“ recent change radar"
                              FontSize="20"
                              FontWeight="SemiBold"
                              Margin="0,0,0,8"/>

                    <!-- Summary / Triage Panel -->
                    <Border Grid.Row="1"
                            Background="#0A1214"
                            CornerRadius="6"
                            Padding="12"
                            BorderBrush="#1A3C3F"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <!-- Counts row -->
                            <StackPanel Orientation="Horizontal" Spacing="24">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#5A1E2C" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepHighCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#FF9999" />
                                    </Border>
                                    <TextBlock Text="HIGH"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#4A3D16" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepMediumCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#FFCC66" />
                                    </Border>
                                    <TextBlock Text="MEDIUM"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#1E3D2A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepLowCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#99CC99" />
                                    </Border>
                                    <TextBlock Text="LOW"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>

                                <Separator Width="1" Background="#333" />

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#5A2A5A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepFocusMatchCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#FF99FF" />
                                    </Border>
                                    <TextBlock Text="Focus match"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Border Background="#4A3A1A" CornerRadius="3" Padding="8,4" MinWidth="32">
                                        <TextBlock x:Name="SweepTimeClusterCount"
                                                  Text="0"
                                                  FontWeight="Bold"
                                                  HorizontalAlignment="Center"
                                                  Foreground="#FFB347" />
                                    </Border>
                                    <TextBlock Text="Time cluster"
                                              VerticalAlignment="Center"
                                              Foreground="#C7D4D4" />
                                </StackPanel>
                            </StackPanel>

                            <!-- Focus targets with timestamps -->
                            <TextBlock x:Name="SweepFocusTargetsText"
                                      Text="Focus targets: (none set)"
                                      FontSize="11"
                                      Foreground="#8FA9AA"
                                      TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>

                    <!-- Controls row -->
                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                Spacing="12"
                                VerticalAlignment="Center">

                      <TextBlock Text="Look back:"
                                VerticalAlignment="Center"/>

                      <ComboBox x:Name="SweepLookbackCombo"
                                Width="140"
                                SelectedIndex="0">
                        <ComboBoxItem Content="24 hours" />
                        <ComboBoxItem Content="3 days" />
                        <ComboBoxItem Content="7 days" />
                        <ComboBoxItem Content="30 days" />
                      </ComboBox>

                      <Button x:Name="SweepRunButton"
                              Content="Run Sweep"
                              Click="SweepRunButton_OnClick" />

                      <Separator Width="16" />

                      <TextBlock Text="Severity:"
                                VerticalAlignment="Center"/>

                      <ComboBox x:Name="SweepSeverityFilterCombo"
                                Width="120"
                                SelectedIndex="0"
                                SelectionChanged="SweepSeverityFilterCombo_OnSelectionChanged">
                        <ComboBoxItem Content="All" />
                        <ComboBoxItem Content="High only" />
                        <ComboBoxItem Content="Medium only" />
                        <ComboBoxItem Content="Low only" />
                      </ComboBox>

                      <CheckBox x:Name="SweepShowOnlyFlaggedCheckBox"
                                Content="MED/HIGH only"
                                Margin="8,0,0,0"
                                IsChecked="True"
                                Checked="SweepFilterCheckBox_OnChanged"
                                Unchecked="SweepFilterCheckBox_OnChanged"/>

                      <Separator Width="16" />

                      <CheckBox x:Name="SweepShowClusterHitsOnlyCheckBox"
                                Content="Cluster hits only"
                                Margin="0"
                                IsChecked="False"
                                Checked="SweepFilterCheckBox_OnChanged"
                                Unchecked="SweepFilterCheckBox_OnChanged"/>

                      <TextBlock Text="Window:"
                                VerticalAlignment="Center"
                                Margin="8,0,0,0"/>

                      <ComboBox x:Name="SweepClusterWindowCombo"
                                Width="100"
                                SelectedIndex="1"
                                SelectionChanged="SweepClusterWindowCombo_OnSelectionChanged">
                        <ComboBoxItem Content="Â± 1 hour" />
                        <ComboBoxItem Content="Â± 2 hours" />
                        <ComboBoxItem Content="Â± 4 hours" />
                        <ComboBoxItem Content="Â± 8 hours" />
                      </ComboBox>

                      <TextBlock x:Name="SweepStatusText"
                                Margin="24,0,0,0"
                                VerticalAlignment="Center"
                                Text="Status: idle."/>
                    </StackPanel>

                            <!-- Search + results -->
                            <Grid Grid.Row="3"
                                  RowDefinitions="Auto,*"
                                  RowSpacing="8">

                              <!-- Search box -->
                              <TextBox Grid.Row="0"
                                      x:Name="SweepSearchTextBox"
                                      Watermark="Search name / path / reason"
                                      TextChanged="SweepSearchTextBox_OnTextChanged"/>

                              <!-- Scrollable results -->
                              <ListBox Grid.Row="1"
                                      x:Name="SweepResultsList"
                                      VerticalAlignment="Stretch">
                                <ListBox.ItemTemplate>
                                  <DataTemplate x:DataType="models:SweepEntry">
                                    <Border Margin="0,0,0,4"
                                            Padding="8"
                                            CornerRadius="4"
                                            Background="#0D1517"
                                            BorderThickness="{Binding ClusterBorderThickness}"
                                            BorderBrush="{Binding ClusterBorderBrush}">
                                      <StackPanel Spacing="4">
                                          <!-- Top line: Severity badge + cluster indicator + category -->
                                          <StackPanel Orientation="Horizontal" Spacing="8">
                                            <Border Padding="6,2"
                                                    CornerRadius="3"
                                                    Background="{Binding SeverityBackground}">
                                              <TextBlock Text="{Binding Severity}"
                                                        FontSize="11"
                                                        FontWeight="SemiBold"
                                                        Foreground="{Binding SeverityForeground}" />
                                            </Border>

                                            <Border Padding="6,2"
                                                    CornerRadius="3"
                                                    Background="#3A2A4A"
                                                    IsVisible="{Binding HasClusterIndicator}">
                                              <TextBlock Text="{Binding ClusterIndicator}"
                                                        FontSize="10"
                                                        FontWeight="Bold"
                                                        Foreground="#FF99FF" />
                                            </Border>

                                            <TextBlock FontSize="11" VerticalAlignment="Center">
                                              <Run Text="["/>
                                              <Run Text="{Binding Category}" />
                                              <Run Text="] " />
                                              <Run Text="{Binding Name}" FontWeight="SemiBold" />
                                            </TextBlock>
                                          </StackPanel>

                                          <!-- Path -->
                                          <TextBlock Text="{Binding Path}"
                                                    FontSize="11"
                                                    Foreground="#c0c0c0"
                                                    TextTrimming="CharacterEllipsis" />

                                          <!-- Modified + Source -->
                                          <TextBlock FontSize="11"
                                                    Foreground="#a0a0a0">
                                            <Run Text="Modified: " />
                                            <Run Text="{Binding Modified}" />
                                            <Run Text="  â€¢  Source: " />
                                            <Run Text="{Binding Source}" />
                                          </TextBlock>

                                          <!-- Reason -->
                                          <TextBlock FontSize="11"
                                                    TextWrapping="Wrap">
                                            <Run Text="Reason: "
                                                FontWeight="SemiBold"
                                                Foreground="#ffb347" />
                                            <Run Text="{Binding Reason}"
                                                Foreground="#ffd47f" />
                                          </TextBlock>

                                          <!-- Cluster target if any -->
                                          <TextBlock FontSize="10"
                                                    Foreground="#9090B0"
                                                    IsVisible="{Binding HasClusterIndicator}">
                                            <Run Text="Clusters with: " />
                                            <Run Text="{Binding ClusterTarget}" FontWeight="SemiBold" />
                                          </TextBlock>
                                        </StackPanel>

                                    </Border>
                                  </DataTemplate>
                                </ListBox.ItemTemplate>
                              </ListBox>
                            </Grid>

                    <!-- Buttons - Button order: Copy, Save, Case, Focus, Investigate, Open, Cleanup -->
                    <StackPanel Grid.Row="4"
                                Orientation="Horizontal"
                                Spacing="8"
                                HorizontalAlignment="Left">
                      <Button x:Name="SweepCopyResultsButton"
                              Content="Copy results"
                              MinWidth="100"
                              Click="SweepCopyResultsButton_OnClick"/>
                      <Button x:Name="SweepSaveResultsButton"
                              Content="Save snapshot"
                              MinWidth="100"
                              Click="SweepSaveResultsButton_OnClick"/>
                      <Button x:Name="SweepAddToCaseButton"
                              Content="Add to case"
                              MinWidth="100"
                              Click="SweepAddToCaseButton_OnClick"/>
                      <Button x:Name="SweepAddToFocusButton"
                              Content="Set as focus"
                              MinWidth="100"
                              Click="SweepAddToFocusButton_OnClick"/>
                      <Button x:Name="SweepInvestigateButton"
                              Content="Investigate"
                              MinWidth="100"
                              Click="SweepInvestigateButton_OnClick"/>
                      <Button x:Name="SweepOpenLocationButton"
                              Content="Open location"
                              MinWidth="100"
                              Click="SweepOpenLocationButton_OnClick"/>
                      <Button x:Name="SweepAddToCleanupButton"
                              Content="Add to Cleanup"
                              MinWidth="110"
                              Click="SweepAddToCleanupButton_OnClick"
                              Background="#4A3D16"
                              Foreground="#FFCC66"/>
                    </StackPanel>

                  </Grid>
                </TabItem>



        <!-- CLEANUP -->
        <TabItem Header="Cleanup">
          <Grid Margin="16">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header / Action buttons -->
            <StackPanel Grid.Row="0"
                        Orientation="Horizontal"
                        Spacing="8"
                        VerticalAlignment="Center">
              <TextBlock Text="Cleanup Queue"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="0,0,8,0" />

              <Button x:Name="CleanupExecuteAllButton"
                      Content="Execute All Pending"
                      Click="CleanupExecuteAllButton_OnClick"
                      MinWidth="150"
                      Margin="0,0,8,0" />

              <Button x:Name="CleanupExecuteSelectedButton"
                      Content="Execute Selected"
                      Click="CleanupExecuteSelectedButton_OnClick"
                      MinWidth="130"
                      Margin="0,0,8,0" />

              <TextBlock x:Name="CleanupStatusText"
                        Text="Status: idle."
                        VerticalAlignment="Center"
                        TextWrapping="Wrap" />
            </StackPanel>

            <!-- Stats / Info panel -->
            <Border Grid.Row="1"
                    Background="#0A1214"
                    CornerRadius="6"
                    Padding="12"
                    Margin="0,12,0,0"
                    BorderBrush="#1A3C3F"
                    BorderThickness="1">
              <StackPanel Orientation="Horizontal" Spacing="24">
                <TextBlock x:Name="CleanupStatsText"
                          Text="Queue: 0 items | Pending: 0 | Completed: 0 | Failed: 0"
                          Foreground="#C7D4D4"
                          VerticalAlignment="Center" />

                <TextBlock x:Name="CleanupQuarantinePathText"
                          Text="Quarantine: (not set)"
                          Foreground="#6B8A8A"
                          VerticalAlignment="Center"
                          FontSize="11" />

                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBlock Text="Quarantine:"
                            Foreground="#8FA9AA"
                            VerticalAlignment="Center" />
                  <Button x:Name="CleanupOpenQuarantineButton"
                          Content="Open Folder"
                          Click="CleanupOpenQuarantineButton_OnClick"
                          Padding="8,4" />
                </StackPanel>
              </StackPanel>
            </Border>

            <!-- Undo buttons row -->
            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        Spacing="12"
                        Margin="0,12,0,8">
              <Button x:Name="CleanupUndoLastButton"
                      Content="Undo Last Action"
                      Click="CleanupUndoLastButton_OnClick"
                      MinWidth="140" />

              <Button x:Name="CleanupUndoSelectedButton"
                      Content="Undo Selected"
                      Click="CleanupUndoSelectedButton_OnClick"
                      MinWidth="120" />

              <Button x:Name="CleanupRemoveSelectedButton"
                      Content="Remove from Queue"
                      Click="CleanupRemoveSelectedButton_OnClick"
                      MinWidth="140" />

              <Separator Width="24" />

              <Button x:Name="CleanupClearQueueButton"
                      Content="Clear Queue"
                      Click="CleanupClearQueueButton_OnClick"
                      MinWidth="100" />
            </StackPanel>

            <!-- Queue list + detail panel -->
            <Grid Grid.Row="3"
                  ColumnDefinitions="2*,*">
              <!-- Queue List - Using ItemsControl to avoid ListBox selection crash -->
              <ScrollViewer Grid.Column="0" Margin="0,0,8,0">
                <ItemsControl x:Name="CleanupQueueList" Background="#050A0C">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:CleanupItem">
                      <Border Padding="8"
                              Margin="0,0,0,4"
                              CornerRadius="4"
                              BorderThickness="2"
                              BorderBrush="#333"
                              Background="#0D1517"
                              PointerPressed="CleanupItem_OnPointerPressed"
                              Cursor="Hand">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                          <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                            <TextBlock Text="{Binding ItemTypeIcon}" FontSize="16" VerticalAlignment="Center" />
                            <Border Padding="6,2" CornerRadius="3" Background="{Binding StatusBackground}">
                              <TextBlock Text="{Binding Status}" FontSize="10" Foreground="{Binding StatusForeground}" FontWeight="SemiBold" />
                            </Border>
                            <Border Padding="6,2" CornerRadius="3" Background="{Binding SeverityBackground}">
                              <TextBlock Text="{Binding Severity}" FontSize="10" Foreground="{Binding SeverityForeground}" FontWeight="SemiBold" />
                            </Border>
                          </StackPanel>
                          <StackPanel Grid.Column="1" Margin="12,0" VerticalAlignment="Center">
                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13" Foreground="#E7F2F2" />
                            <TextBlock Text="{Binding OriginalPath}" FontSize="11" Foreground="#8FA9AA" TextTrimming="CharacterEllipsis" />
                          </StackPanel>
                          <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                            <TextBlock Text="{Binding Action}" FontSize="11" Foreground="#00FFF8" VerticalAlignment="Center" />
                            <TextBlock Text="{Binding SourceTab}" FontSize="10" Foreground="#666" VerticalAlignment="Center" />
                          </StackPanel>
                        </Grid>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>

              <!-- Detail panel -->
              <Border Grid.Column="1"
                      Background="#0A1214"
                      CornerRadius="4"
                      BorderThickness="1"
                      BorderBrush="#333"
                      Padding="12">
                <StackPanel Spacing="8">
                  <TextBlock Text="Selected Item Details"
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="#E7F2F2" />

                  <TextBlock x:Name="CleanupDetailNoSelection"
                            Text="Click an item to view details"
                            FontSize="11"
                            Foreground="#666"
                            FontStyle="Italic" />

                  <StackPanel x:Name="CleanupDetailPanel" Spacing="6" IsVisible="False">
                    <TextBlock x:Name="CleanupDetailType" FontSize="11" Foreground="#C7D4D4" />
                    <TextBlock x:Name="CleanupDetailName" FontSize="12" Foreground="#E7F2F2" FontWeight="SemiBold" />
                    <TextBlock x:Name="CleanupDetailPath" FontSize="11" Foreground="#8FA9AA" TextWrapping="Wrap" />
                    <TextBlock x:Name="CleanupDetailAction" FontSize="11" Foreground="#00FFF8" />
                    <TextBlock x:Name="CleanupDetailStatus" FontSize="11" />
                    <TextBlock x:Name="CleanupDetailSeverity" FontSize="11" />
                    <TextBlock x:Name="CleanupDetailSource" FontSize="11" Foreground="#8FA9AA" />
                    <TextBlock x:Name="CleanupDetailReason" FontSize="11" Foreground="#C7D4D4" TextWrapping="Wrap" />
                    <TextBlock x:Name="CleanupDetailQuarantine" FontSize="11" Foreground="#99CC99" TextWrapping="Wrap" />
                    <Border x:Name="CleanupDetailErrorBorder"
                            Background="#3A1E2C"
                            CornerRadius="4"
                            Padding="8"
                            IsVisible="False"
                            Margin="0,8,0,0">
                      <StackPanel>
                        <TextBlock Text="ERROR:" FontSize="11" Foreground="#FF6666" FontWeight="Bold" />
                        <TextBlock x:Name="CleanupDetailError" FontSize="11" Foreground="#FF9999" TextWrapping="Wrap" />
                      </StackPanel>
                    </Border>
                  </StackPanel>
                </StackPanel>
              </Border>
            </Grid>
          </Grid>
        </TabItem>

        <!-- HARDEN -->
        <TabItem Header="Harden">
          <Grid Margin="16" RowDefinitions="Auto,Auto,Auto,*,Auto" RowSpacing="12">

            <!-- Title + Description -->
            <StackPanel Grid.Row="0" Spacing="4">
              <TextBlock Text="Harden"
                        FontSize="20"
                        FontWeight="SemiBold"
                        Foreground="#EAF7F7" />
              <TextBlock Text="Apply security controls to prevent reinfection. All changes can be rolled back."
                        FontSize="13"
                        Foreground="#8FA9AA"
                        TextWrapping="Wrap" />
            </StackPanel>

            <!-- Profile Selection + Stats -->
            <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
              <!-- Profile Buttons -->
              <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                <TextBlock Text="Profile:" VerticalAlignment="Center" Foreground="#8FA9AA" />
                <RadioButton x:Name="HardenProfileStandard"
                            Content="Standard"
                            GroupName="HardenProfile"
                            IsChecked="True"
                            Foreground="#C7D4D4" />
                <RadioButton x:Name="HardenProfileStrict"
                            Content="Strict"
                            GroupName="HardenProfile"
                            Foreground="#C7D4D4" />
                <RadioButton x:Name="HardenProfileCustom"
                            Content="Custom"
                            GroupName="HardenProfile"
                            Foreground="#C7D4D4" />
                <Button x:Name="HardenLoadProfileButton"
                        Content="Load Profile"
                        Click="HardenLoadProfileButton_OnClick"
                        MinWidth="100" />
              </StackPanel>

              <!-- Stats Panel -->
              <Border Grid.Column="2"
                      Background="#050E10"
                      Padding="12,6"
                      CornerRadius="4">
                <StackPanel Orientation="Horizontal" Spacing="16">
                  <TextBlock x:Name="HardenStatsApplied"
                            Text="Applied: 0"
                            FontSize="12"
                            Foreground="#99CC99" />
                  <TextBlock x:Name="HardenStatsPending"
                            Text="Selected: 0"
                            FontSize="12"
                            Foreground="#FFCC66" />
                  <TextBlock x:Name="HardenStatsSkipped"
                            Text="Already Set: 0"
                            FontSize="12"
                            Foreground="#66CCFF" />
                </StackPanel>
              </Border>
            </Grid>

            <!-- Scan Button + Status -->
            <Grid Grid.Row="2" ColumnDefinitions="Auto,*">
              <Button x:Name="HardenScanButton"
                      Grid.Column="0"
                      Content="Scan Current State"
                      Click="HardenScanButton_OnClick"
                      MinWidth="150" />
              <TextBlock x:Name="HardenStatusText"
                        Grid.Column="1"
                        Text="Status: Click 'Scan Current State' to detect system configuration."
                        VerticalAlignment="Center"
                        Margin="12,0,0,0"
                        Foreground="#8FA9AA" />
            </Grid>

            <!-- Actions List -->
            <ScrollViewer Grid.Row="3">
              <ItemsControl x:Name="HardenActionsList" Background="#050A0C">
                <ItemsControl.ItemTemplate>
                  <DataTemplate x:DataType="models:HardenAction">
                    <Border Padding="10"
                            Margin="0,0,0,4"
                            CornerRadius="4"
                            Background="#0D1517"
                            BorderThickness="2"
                            BorderBrush="#333">
                      <Grid ColumnDefinitions="Auto,Auto,*,Auto">
                        <!-- Checkbox -->
                        <CheckBox Grid.Column="0"
                                  IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                  VerticalAlignment="Center"
                                  Margin="0,0,10,0"
                                  IsEnabled="{Binding !IsAlreadyHardened}" />

                        <!-- Status Icon + Category -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                          <TextBlock Text="{Binding StatusIcon}"
                                    FontSize="14"
                                    Foreground="{Binding StatusColor}"
                                    VerticalAlignment="Center" />
                          <Border Padding="6,2"
                                  CornerRadius="3"
                                  Background="{Binding CategoryBackground}">
                            <TextBlock Text="{Binding Category}"
                                      FontSize="10"
                                      Foreground="{Binding CategoryForeground}"
                                      FontWeight="SemiBold" />
                          </Border>
                        </StackPanel>

                        <!-- Name + State -->
                        <StackPanel Grid.Column="2" Margin="12,0" VerticalAlignment="Center">
                          <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="{Binding Name}"
                                      FontWeight="SemiBold"
                                      FontSize="13"
                                      Foreground="#E7F2F2" />
                            <TextBlock Text="âš "
                                      FontSize="12"
                                      Foreground="#FFCC66"
                                      IsVisible="{Binding HasWarning}"
                                      ToolTip.Tip="{Binding WarningMessage}" />
                          </StackPanel>
                          <TextBlock Text="{Binding StateDisplay}"
                                    FontSize="11"
                                    Foreground="#8FA9AA" />
                        </StackPanel>

                        <!-- Profile indicator -->
                        <TextBlock Grid.Column="3"
                                  Text="{Binding Profile}"
                                  FontSize="10"
                                  Foreground="#666"
                                  VerticalAlignment="Center" />
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </ScrollViewer>

            <!-- Buttons -->
            <StackPanel Grid.Row="4"
                        Orientation="Horizontal"
                        Spacing="8"
                        HorizontalAlignment="Left">
              <Button x:Name="HardenApplySelectedButton"
                      Content="Apply Selected"
                      MinWidth="120"
                      Click="HardenApplySelectedButton_OnClick"
                      Background="#1E3D2A"
                      Foreground="#99CC99" />
              <Button x:Name="HardenRollbackLastButton"
                      Content="Rollback Last"
                      MinWidth="110"
                      Click="HardenRollbackLastButton_OnClick" />
              <Button x:Name="HardenRollbackAllButton"
                      Content="Rollback All"
                      MinWidth="100"
                      Click="HardenRollbackAllButton_OnClick" />
              <Button x:Name="HardenSelectAllButton"
                      Content="Select All"
                      MinWidth="90"
                      Click="HardenSelectAllButton_OnClick" />
              <Button x:Name="HardenDeselectAllButton"
                      Content="Deselect All"
                      MinWidth="90"
                      Click="HardenDeselectAllButton_OnClick" />
            </StackPanel>

          </Grid>
        </TabItem>

                <!-- CASE -->
                <TabItem Header="Case">
                  <Border Background="#0B1518" Padding="16">
                    <StackPanel Orientation="Vertical" Spacing="12">

                      <!-- TITLE -->
                      <TextBlock Text="Case timeline"
                                FontSize="20"
                                FontWeight="SemiBold"
                                Foreground="#EAF7F7" />

                      <TextBlock Text="Everything that has happened in this incident: scans, findings, and actions. Export this log for your ticket or IR lead."
                                FontSize="13"
                                Foreground="#8FA9AA"
                                TextWrapping="Wrap" />

                     <!-- SUMMARY ROW -->
                    <Grid ColumnDefinitions="2*,*,*,*" Margin="0,8,0,0">
                      <!-- Case ID -->
                      <StackPanel Grid.Column="0"
                                  Spacing="2">
                        <TextBlock Text="Case ID"
                                  FontSize="11"
                                  Foreground="#8FA9AA" />
                        <TextBlock x:Name="CaseSummaryIdText"
                                  Text="(no case yet)"
                                  FontSize="13"
                                  Foreground="#C7D4D4"
                                  TextWrapping="Wrap" />
                      </StackPanel>

                      <!-- Host -->
                      <StackPanel Grid.Column="1"
                                  Spacing="2">
                        <TextBlock Text="Host"
                                  FontSize="11"
                                  Foreground="#8FA9AA" />
                        <TextBlock x:Name="CaseSummaryHostText"
                                  Text="(host)"
                                  FontSize="13"
                                  Foreground="#C7D4D4" />
                      </StackPanel>

                      <!-- User -->
                      <StackPanel Grid.Column="2"
                                  Spacing="2">
                        <TextBlock Text="User"
                                  FontSize="11"
                                  Foreground="#8FA9AA" />
                        <TextBlock x:Name="CaseSummaryUserText"
                                  Text="(user)"
                                  FontSize="13"
                                  Foreground="#C7D4D4" />
                      </StackPanel>

                      <!-- Started -->
                      <StackPanel Grid.Column="3"
                                  Spacing="2">
                        <TextBlock Text="Started"
                                  FontSize="11"
                                  Foreground="#8FA9AA" />
                        <TextBlock x:Name="CaseSummaryStartedText"
                                  Text="(time)"
                                  FontSize="13"
                                  Foreground="#C7D4D4" />
                      </StackPanel>
                    </Grid>

                                          <!-- CASE FOCUS ROW -->
                      <StackPanel Orientation="Horizontal"
                                  Spacing="8"
                                  Margin="0,12,0,0">
                        <TextBlock Text="Case focus:"
                                   VerticalAlignment="Center"
                                   Foreground="#8FA9AA" />
                        <TextBox x:Name="CaseFocusTextBox"
                                 Width="260"
                                 Watermark="File path, name, hash, etc." />
                        <Button Content="Set"
                                Width="70"
                                Click="CaseFocusSetButton_OnClick" />
                        <Button Content="Clear"
                                Width="70"
                                Click="CaseFocusClearButton_OnClick" />
                        <TextBlock x:Name="CaseFocusStatusText"
                                   Margin="12,0,0,0"
                                   VerticalAlignment="Center"
                                   FontSize="11"
                                   Foreground="#8FA9AA"
                                   Text="Focus: (none)" />
                      </StackPanel>

                      <!-- BUTTONS -->
                      <StackPanel Orientation="Horizontal"
                                  Spacing="8"
                                  Margin="0,12,0,0">
                        <Button Content="Refresh"
                                Width="100"
                                Click="CaseRefreshButton_OnClick" />
                        <Button Content="Export case report"
                                Width="160"
                                Click="CaseExportButton_OnClick" />
                      </StackPanel>

                      <!-- EVENTS LIST -->
                      <Border Margin="0,12,0,0"
                              Background="#050E10"
                              Padding="8">
                          <ListBox x:Name="CaseEventsList"
                                  BorderThickness="0"
                                  Height="760"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto">
                          <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="models:CaseEvent">
                              <StackPanel Margin="0,4" Spacing="2">
                                <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}"
                                          FontSize="11"
                                          Foreground="#7FA3A4" />
                                <TextBlock>
                                  <Run Text="[" />
                                  <Run Text="{Binding Tab}" />
                                  <Run Text="] " />
                                  <Run Text="{Binding Severity}" />
                                  <Run Text=" â€“ " />
                                  <Run Text="{Binding Action}" />
                                </TextBlock>
                                <TextBlock Text="{Binding Target}"
                                          FontSize="11"
                                          Foreground="#9FB9BA"
                                          TextWrapping="Wrap" />
                                <TextBlock Text="{Binding Details}"
                                          FontSize="11"
                                          Foreground="#9FB9BA"
                                          TextWrapping="Wrap" />
                              </StackPanel>
                            </DataTemplate>
                          </ListBox.ItemTemplate>
                        </ListBox>
                      </Border>

                    </StackPanel>
                  </Border>
                </TabItem>

        <!-- HELP -->
        <TabItem Header="Help">
          <Border Background="#0B1518" Padding="16">
            <Grid RowDefinitions="Auto,Auto,*" RowSpacing="12">

              <!-- Title -->
              <TextBlock Grid.Row="0"
                        Text="ViperKit Help &amp; Documentation"
                        FontSize="18"
                        FontWeight="SemiBold"
                        Foreground="#EAF7F7" />

              <!-- Search Box -->
              <Border Grid.Row="1" Background="#0D1517" Padding="10" CornerRadius="4">
                <StackPanel Spacing="8">
                  <TextBlock Text="Search Help Topics" FontSize="12" Foreground="#8FA9AA" />
                  <TextBox x:Name="HelpSearchBox"
                          Watermark="Type to search help topics..."
                          TextChanged="HelpSearchBox_OnTextChanged" />
                </StackPanel>
              </Border>

              <!-- Help Content (Scrollable) -->
              <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                <StackPanel x:Name="HelpContentPanel" Spacing="16">

                  <!-- SAFETY RULES -->
                  <Border Background="#1A0A0A" BorderBrush="#4A1616" BorderThickness="2" Padding="12" CornerRadius="6">
                    <StackPanel Spacing="8">
                      <TextBlock Text="âš  SAFETY RULES" FontSize="16" FontWeight="Bold" Foreground="#FF6666" />
                      <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#FFCCCC">
                        â€¢ ALWAYS add suspicious items to the case BEFORE removing them<LineBreak/>
                        â€¢ ALWAYS run Hunt to find related artifacts BEFORE using Cleanup<LineBreak/>
                        â€¢ ALWAYS preview before executing any cleanup or hardening actions<LineBreak/>
                        â€¢ ALWAYS export a case report before making system changes<LineBreak/>
                        â€¢ ALWAYS capture a baseline AFTER cleaning but BEFORE considering the system safe<LineBreak/>
                        â€¢ NEVER run ViperKit on a production domain controller without approval<LineBreak/>
                        â€¢ NEVER assume the system is clean - ViperKit is NOT an EDR or antivirus<LineBreak/>
                        â€¢ ALWAYS monitor the system for 2-4 weeks after incident response
                      </TextBlock>
                    </StackPanel>
                  </Border>

                  <!-- QUICK START -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A4A3F" BorderThickness="1">
                    <Expander Header="Quick Start Guide" IsExpanded="True">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Recommended Workflow:</Bold><LineBreak/>
                          <LineBreak/>
                          <Bold>1. Start or Load Case</Bold> - Create a new case with a descriptive name or load an existing one<LineBreak/>
                          <LineBreak/>
                          <Bold>2. Hunt</Bold> - Enter the suspicious IOC (file, domain, hash, etc.) you FOUND (DON'T remove it yet!)<LineBreak/>
                          â†’ Add the IOC to the case to document your findings<LineBreak/>
                          â†’ Set it as "case focus" to track it across all tabs<LineBreak/>
                          <LineBreak/>
                          <Bold>3. Persist</Bold> - Scan for persistence mechanisms related to your focus<LineBreak/>
                          â†’ Check PowerShell history for attacker commands<LineBreak/>
                          â†’ Add suspicious items to cleanup queue<LineBreak/>
                          <LineBreak/>
                          <Bold>4. Sweep</Bold> - Find other artifacts installed around the same time (time clustering)<LineBreak/>
                          â†’ Expand your focus with related items<LineBreak/>
                          <LineBreak/>
                          <Bold>5. Persist (Again)</Bold> - Re-scan with expanded focus to catch everything<LineBreak/>
                          <LineBreak/>
                          <Bold>6. Cleanup</Bold> - Preview and execute remediation actions<LineBreak/>
                          â†’ Items can be undone if needed<LineBreak/>
                          <LineBreak/>
                          <Bold>7. Harden</Bold> - Apply security controls to prevent reinfection<LineBreak/>
                          â†’ Use Standard profile for most cases, Strict for high-risk environments<LineBreak/>
                          <LineBreak/>
                          <Bold>8. Baseline</Bold> - Capture current state for future comparison<LineBreak/>
                          <LineBreak/>
                          <Bold>9. Export Report</Bold> - Generate professional PDF report with recommendations
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- DASHBOARD TAB -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Dashboard Tab">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Purpose:</Bold> Case management, system overview, and baseline monitoring<LineBreak/>
                          <LineBreak/>
                          <Bold>Features:</Bold><LineBreak/>
                          â€¢ Start New Case - Begin investigation with optional custom name<LineBreak/>
                          â€¢ Load Existing Case - Resume previous investigation<LineBreak/>
                          â€¢ System Snapshot - View host info, OS, user<LineBreak/>
                          â€¢ Baseline Capture - Save current persistence state for comparison<LineBreak/>
                          â€¢ Compare to Baseline - Detect new persistence since baseline<LineBreak/>
                          â€¢ Demo Mode - Guided walkthrough for training<LineBreak/>
                          <LineBreak/>
                          <Bold>Tip:</Bold> Always capture a baseline AFTER cleaning to monitor for reinfection
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- HUNT TAB -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Hunt Tab">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Purpose:</Bold> Find and track the initial threat indicator<LineBreak/>
                          <LineBreak/>
                          <Bold>Supported IOC Types:</Bold><LineBreak/>
                          â€¢ File paths (C:\path\to\file.exe)<LineBreak/>
                          â€¢ File hashes (MD5, SHA1, SHA256)<LineBreak/>
                          â€¢ Domains and URLs (malicious.com)<LineBreak/>
                          â€¢ IP addresses (192.168.1.100)<LineBreak/>
                          â€¢ Registry keys and values<LineBreak/>
                          <LineBreak/>
                          <Bold>Features:</Bold><LineBreak/>
                          â€¢ Auto-detect IOC type or manually select<LineBreak/>
                          â€¢ Optional scope folder for targeted file scanning<LineBreak/>
                          â€¢ Set as case focus to highlight across all tabs<LineBreak/>
                          <LineBreak/>
                          <Bold>âš  Important:</Bold> DON'T remove the suspicious item yet! Add it to the case first, run Hunt to find all related artifacts, THEN use Cleanup to remove everything.
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- PERSIST TAB -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Persist Tab">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Purpose:</Bold> Detect persistence mechanisms and analyze PowerShell history<LineBreak/>
                          <LineBreak/>
                          <Bold>Scanned Locations:</Bold><LineBreak/>
                          â€¢ Registry Run keys (HKCU/HKLM)<LineBreak/>
                          â€¢ Startup folders (all users + current user)<LineBreak/>
                          â€¢ Scheduled tasks<LineBreak/>
                          â€¢ Windows services<LineBreak/>
                          â€¢ WMI event subscriptions<LineBreak/>
                          â€¢ Shell extensions and browser helpers<LineBreak/>
                          <LineBreak/>
                          <Bold>PowerShell History:</Bold><LineBreak/>
                          â€¢ Analyzes command history for suspicious patterns<LineBreak/>
                          â€¢ Detects encoded commands, downloads, execution bypasses<LineBreak/>
                          â€¢ Risk-scored (HIGH/MEDIUM/LOW)<LineBreak/>
                          <LineBreak/>
                          <Bold>Filters:</Bold><LineBreak/>
                          â€¢ Show only CHECK (high-risk) items<LineBreak/>
                          â€¢ Filter by location type (Registry, Services, Tasks)<LineBreak/>
                          â€¢ Filter by focus match<LineBreak/>
                          â€¢ Search text across all fields<LineBreak/>
                          <LineBreak/>
                          <Bold>Tip:</Bold> CHECK items are highest priority - investigate these first
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- SWEEP TAB -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Sweep Tab">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Purpose:</Bold> Find related artifacts through time and folder clustering<LineBreak/>
                          <LineBreak/>
                          <Bold>Clustering Methods:</Bold><LineBreak/>
                          â€¢ <Bold>Time Clustering:</Bold> Files/services created within Â±1-8 hours of focus target<LineBreak/>
                          â€¢ <Bold>Folder Clustering:</Bold> Items in same directory tree as focus target<LineBreak/>
                          â€¢ <Bold>Direct Match:</Bold> Items matching focus target name/path<LineBreak/>
                          <LineBreak/>
                          <Bold>Scanned Locations:</Bold><LineBreak/>
                          â€¢ Desktop (all users)<LineBreak/>
                          â€¢ Downloads<LineBreak/>
                          â€¢ Temp folders<LineBreak/>
                          â€¢ AppData<LineBreak/>
                          â€¢ Recent items<LineBreak/>
                          â€¢ Services and drivers<LineBreak/>
                          <LineBreak/>
                          <Bold>Tip:</Bold> Malware often drops multiple files at once - time clustering catches them
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- CLEANUP TAB -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Cleanup Tab">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Purpose:</Bold> Safe remediation with rollback capability<LineBreak/>
                          <LineBreak/>
                          <Bold>Supported Actions:</Bold><LineBreak/>
                          â€¢ Delete files<LineBreak/>
                          â€¢ Remove registry keys/values<LineBreak/>
                          â€¢ Stop and disable services<LineBreak/>
                          â€¢ Delete scheduled tasks<LineBreak/>
                          â€¢ Remove WMI subscriptions<LineBreak/>
                          <LineBreak/>
                          <Bold>Safety Features:</Bold><LineBreak/>
                          â€¢ Preview all actions before executing<LineBreak/>
                          â€¢ Cleanup journal tracks all changes<LineBreak/>
                          â€¢ Undo capability for reversible actions<LineBreak/>
                          â€¢ Export case report before cleanup (recommended)<LineBreak/>
                          <LineBreak/>
                          <Bold>Workflow:</Bold><LineBreak/>
                          1. Review items in queue<LineBreak/>
                          2. Export case report (CRITICAL)<LineBreak/>
                          3. Preview cleanup actions<LineBreak/>
                          4. Execute cleanup<LineBreak/>
                          5. Verify results<LineBreak/>
                          6. Undo if needed<LineBreak/>
                          <LineBreak/>
                          <Bold>âš  Warning:</Bold> File deletions cannot be undone - export report first!
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- HARDEN TAB -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Harden Tab">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Purpose:</Bold> Apply security controls to prevent reinfection<LineBreak/>
                          <LineBreak/>
                          <Bold>Profiles:</Bold><LineBreak/>
                          â€¢ <Bold>Standard:</Bold> Balanced security for most environments<LineBreak/>
                          â€¢ <Bold>Strict:</Bold> Maximum security, may impact compatibility<LineBreak/>
                          â€¢ <Bold>Custom:</Bold> Manually select individual actions<LineBreak/>
                          <LineBreak/>
                          <Bold>Categories:</Bold><LineBreak/>
                          â€¢ Script Execution - Block WSH, restrict PowerShell<LineBreak/>
                          â€¢ Firewall - Enable Windows Firewall, block inbound<LineBreak/>
                          â€¢ Defender - Enable real-time protection, cloud delivery<LineBreak/>
                          â€¢ AutoRun - Disable autoplay/autorun for removable media<LineBreak/>
                          â€¢ Remote Access - Restrict RDP, disable RemoteRegistry<LineBreak/>
                          â€¢ Office - Enable macro protections<LineBreak/>
                          <LineBreak/>
                          <Bold>Rollback:</Bold><LineBreak/>
                          â€¢ All actions are journaled and can be rolled back<LineBreak/>
                          â€¢ Rollback Last - Undo most recent action<LineBreak/>
                          â€¢ Rollback All - Undo all hardening for this case<LineBreak/>
                          <LineBreak/>
                          <Bold>Tip:</Bold> Blue items are already hardened, green items were applied by you
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- CASE TAB -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Case Tab">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Purpose:</Bold> Timeline tracking and professional reporting<LineBreak/>
                          <LineBreak/>
                          <Bold>Features:</Bold><LineBreak/>
                          â€¢ Full timeline of all case events<LineBreak/>
                          â€¢ Focus target management<LineBreak/>
                          â€¢ PDF report export with recommendations<LineBreak/>
                          <LineBreak/>
                          <Bold>PDF Report Includes:</Bold><LineBreak/>
                          â€¢ Executive summary with risk breakdown<LineBreak/>
                          â€¢ Critical next steps (password resets, monitoring, etc.)<LineBreak/>
                          â€¢ Scans performed with findings<LineBreak/>
                          â€¢ Top high-risk findings<LineBreak/>
                          â€¢ Remediation actions taken<LineBreak/>
                          â€¢ Hardening applied<LineBreak/>
                          â€¢ Baseline info<LineBreak/>
                          â€¢ Timeline of key events<LineBreak/>
                          <LineBreak/>
                          <Bold>File Location:</Bold> Documents\ViperKit\Reports\
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- FILE LOCATIONS -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="File Locations">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4" FontFamily="Consolas">
                          <Bold>ViperKit Data Locations:</Bold><LineBreak/>
                          <LineBreak/>
                          Cases:<LineBreak/>
                          C:\ProgramData\ViperKit\Cases\{CaseID}\case.json<LineBreak/>
                          <LineBreak/>
                          Case Exports (TXT):<LineBreak/>
                          C:\ProgramData\ViperKit\Cases\{CaseID}\case_export.txt<LineBreak/>
                          <LineBreak/>
                          PDF Reports:<LineBreak/>
                          C:\Users\{User}\Documents\ViperKit\Reports\*.pdf<LineBreak/>
                          <LineBreak/>
                          Cleanup Journals:<LineBreak/>
                          C:\ProgramData\ViperKit\CleanupJournals\{CaseID}_cleanup.json<LineBreak/>
                          <LineBreak/>
                          Harden Journals:<LineBreak/>
                          C:\ProgramData\ViperKit\HardenJournals\{CaseID}_harden.json<LineBreak/>
                          <LineBreak/>
                          Baselines:<LineBreak/>
                          Stored in case.json within Cases folder
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- TIPS & BEST PRACTICES -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Tips &amp; Best Practices">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>General Tips:</Bold><LineBreak/>
                          â€¢ Use descriptive case names (e.g., "Ticket-12345" or "Ransomware-2024-11")<LineBreak/>
                          â€¢ Export PDF report BEFORE making any changes<LineBreak/>
                          â€¢ Take screenshots of critical findings<LineBreak/>
                          â€¢ Document your reasoning in case notes<LineBreak/>
                          <LineBreak/>
                          <Bold>Investigation Tips:</Bold><LineBreak/>
                          â€¢ Start broad, narrow down with focus<LineBreak/>
                          â€¢ Run Persist scan multiple times as you expand focus<LineBreak/>
                          â€¢ Check PowerShell history even if nothing obvious in Persist<LineBreak/>
                          â€¢ Sweep finds things Hunt might miss<LineBreak/>
                          â€¢ Look for time clusters within Â±1-2 hours for precision<LineBreak/>
                          <LineBreak/>
                          <Bold>Cleanup Tips:</Bold><LineBreak/>
                          â€¢ Review EVERY item in cleanup queue before executing<LineBreak/>
                          â€¢ Export case report first (can't undo file deletions)<LineBreak/>
                          â€¢ Test on a non-critical system first if unsure<LineBreak/>
                          â€¢ Consider creating a system restore point<LineBreak/>
                          <LineBreak/>
                          <Bold>Post-Cleanup Tips:</Bold><LineBreak/>
                          â€¢ Capture baseline immediately after cleanup<LineBreak/>
                          â€¢ Re-scan daily for first week<LineBreak/>
                          â€¢ Compare to baseline weekly for 2-4 weeks<LineBreak/>
                          â€¢ Reset ALL passwords (see PDF report recommendations)<LineBreak/>
                          â€¢ Deploy proper EDR/antivirus if not present<LineBreak/>
                          <LineBreak/>
                          <Bold>When to Reimage:</Bold><LineBreak/>
                          â€¢ Attacker had domain admin access<LineBreak/>
                          â€¢ Ransomware encryption occurred<LineBreak/>
                          â€¢ Rootkit or bootkit suspected<LineBreak/>
                          â€¢ Multiple reinfections after cleanup<LineBreak/>
                          â€¢ Critical server or domain controller compromised
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- FAQ -->
                  <Border Background="#050E10" Padding="12" CornerRadius="6" BorderBrush="#1A3C3F" BorderThickness="1">
                    <Expander Header="Frequently Asked Questions">
                      <StackPanel Spacing="8" Margin="0,8,0,0">
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#C7D4D4">
                          <Bold>Q: Does ViperKit need to run as Administrator?</Bold><LineBreak/>
                          A: YES. ViperKit REQUIRES administrator privileges to access registry, services, scheduled tasks, system files, and perform remediation actions. Right-click and "Run as Administrator".<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: Can I use ViperKit instead of antivirus?</Bold><LineBreak/>
                          A: NO. ViperKit is for incident response, not ongoing protection. Deploy proper EDR/AV.<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: Will cleanup break my system?</Bold><LineBreak/>
                          A: Preview all actions first. Avoid deleting system files. Export report before cleanup.<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: How do I know if I got everything?</Bold><LineBreak/>
                          A: You don't. Capture baseline, monitor for 2-4 weeks, compare regularly. Consider reimaging.<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: What if I accidentally deleted something important?</Bold><LineBreak/>
                          A: Cleanup journal shows what was deleted. File deletions cannot be undone. Restore from backup.<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: Can I run this on a domain controller?</Bold><LineBreak/>
                          A: Only with approval. Test hardening profile impact first. Consider replication delays.<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: How often should I capture baselines?</Bold><LineBreak/>
                          A: Once immediately after cleanup, then monthly for ongoing monitoring.<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: What does "NEW" badge mean in Persist tab?</Bold><LineBreak/>
                          A: Item was added since last baseline capture - potential reinfection indicator.<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: Should I use Standard or Strict hardening?</Bold><LineBreak/>
                          A: Standard for most cases. Strict for high-risk environments (may break some apps).<LineBreak/>
                          <LineBreak/>
                          <Bold>Q: Where are my reports saved?</Bold><LineBreak/>
                          A: PDF: Documents\ViperKit\Reports\, Case data: C:\ProgramData\ViperKit\Cases\
                        </TextBlock>
                      </StackPanel>
                    </Expander>
                  </Border>

                  <!-- VERSION INFO -->
                  <Border Background="#0A1518" Padding="10" CornerRadius="4" BorderBrush="#1A3A3F" BorderThickness="1">
                    <TextBlock TextWrapping="Wrap" FontSize="10" Foreground="#8FA9AA" TextAlignment="Center">
                      ViperKit v1.0 | Incident Response Toolkit<LineBreak/>
                      Open Source Project: https://github.com/jtarkington77/Viperkit<LineBreak/>
                      Report issues or feature requests on GitHub - Use at your own risk<LineBreak/>
                      No warranty or guarantee of issue resolution - Not responsible for any damages<LineBreak/>
                      Always verify findings and maintain backups before remediation
                    </TextBlock>
                  </Border>

                </StackPanel>
              </ScrollViewer>

            </Grid>
          </Border>
        </TabItem>

      </TabControl>
    </Border>
  </Grid>
</Window>
